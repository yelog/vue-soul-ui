"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_tools=require("../../tools"),_tableCore=require("../../table-core");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var _default={moveCtxMenu:function(e,t,l,i,n,o,s){var r,c=_xeUtils.default.findIndexOf(s,function(e){return l[i]===e});if(t===n)o&&_tools.UtilTools.hasChildrenList(l.selected)?l.showChild=!0:(l.showChild=!1,l.selectChild=null);else if(38===t){for(var u=c-1;0<=u;u--)if(!1!==s[u].visible){r=s[u];break}l[i]=r||s[s.length-1]}else if(40===t){for(var a=c+1;a<s.length;a++)if(!1!==s[a].visible){r=s[a];break}l[i]=r||s[0]}else!l[i]||13!==t&&32!==t||this.ctxMenuLinkEvent(e,l[i])},handleGlobalContextmenuEvent:function(e){var t=this.isCtxMenu,l=this.ctxMenuStore,i=this.ctxMenuOpts,n=["header","body","footer"];if(t){if(l.visible&&l.visible&&this.$refs.ctxWrapper&&this.getEventTargetNode(e,this.$refs.ctxWrapper.$el).flag)return void e.preventDefault();for(var o=0;o<n.length;o++){var s=n[o],r=this.getEventTargetNode(e,this.$el,"s-".concat(s,"--column")),c={type:s,$table:this,columns:this.visibleColumn.slice(0)};if(r.flag){var u=r.targetElem,a=this.getColumnNode(u).item,h="".concat(s,"-");if(Object.assign(c,{column:a,columnIndex:this.getColumnIndex(a),cell:u}),"body"===s){var d=this.getRowNode(u.parentNode).item;h="",c.row=d,c.rowIndex=this.getRowIndex(d)}return this.openContextMenu(e,s,c),void _tools.UtilTools.emitEvent(this,"".concat(h,"cell-context-menu"),[c,e])}if(this.getEventTargetNode(e,this.$el,"s-table--".concat(s,"-wrapper")).flag)return void("cell"===i.trigger?e.preventDefault():this.openContextMenu(e,s,c))}}this.closeMenu(),this.closeFilter()},openContextMenu:function(u,e,i){var a=this,h=this.ctxMenuStore,t=this.ctxMenuOpts,l=t[e],n=t.visibleMethod;if(l){var d=l.options;l.disabled?u.preventDefault():d&&d.length&&(i.options=d,this.preventEvent(u,"event.show_menu",i,null,function(){if(!n||n(i,u)){u.preventDefault();var e=_tools.DomTools.getDomNode(),t=e.scrollTop,l=e.scrollLeft,o=e.visibleHeight,s=e.visibleWidth,r=u.clientY+t,c=u.clientX+l;Object.assign(h,{args:i,visible:!0,list:d,selected:null,selectChild:null,showChild:!1,style:{top:"".concat(r,"px"),left:"".concat(c,"px")}}),a.$nextTick(function(){var e=a.$refs.ctxWrapper.$el,t=e.clientHeight,l=e.clientWidth,i=u.clientY+t-o,n=u.clientX+l-s;-10<i&&(h.style.top="".concat(r-t,"px")),-10<n&&(h.style.left="".concat(c-l,"px"))})}else a.closeMenu()}))}this.closeFilter()},ctxMenuMouseoverEvent:function(e,t,l){var i=this.ctxMenuStore;e.preventDefault(),e.stopPropagation(),i.selected=t,(i.selectChild=l)||(i.showChild=_tools.UtilTools.hasChildrenList(t))},ctxMenuMouseoutEvent:function(e,t,l){var i=this.ctxMenuStore;t.children||(i.selected=null),i.selectChild=null},ctxMenuLinkEvent:function(e,t){if(!(t.disabled||t.children&&t.children.length)){var l=_tableCore.Menus.get(t.code),i=Object.assign({menu:t,$table:this},this.ctxMenuStore.args);l&&l.call(this,i,e),_tools.UtilTools.emitEvent(this,"context-menu-click",[i,e]),this.closeMenu()}}};exports.default=_default;
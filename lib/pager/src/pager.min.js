"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _default2={name:"SPager",props:{size:String,layouts:{type:Array,default:function(){return _conf.default.pager.layouts||["PrevJump","PrevPage","Jump","PageCount","NextPage","NextJump","Sizes","Total"]}},currentPage:{type:Number,default:1},loading:Boolean,pageSize:{type:Number,default:function(){return _conf.default.pager.pageSize||10}},total:{type:Number,default:0},pagerCount:{type:Number,default:function(){return _conf.default.pager.pagerCount||7}},pageSizes:{type:Array,default:function(){return _conf.default.pager.pageSizes||[10,15,20,50,100]}},align:String,background:Boolean},inject:{$grid:{default:null}},data:function(){return{showSizes:!1,panelStyle:null}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},isSizes:function(){return this.layouts.some(function(e){return"Sizes"===e})},pageCount:function(){return this.getPageCount(this.total,this.pageSize)},numList:function(){return Array.from(new Array(this.pageCount>this.pagerCount?this.pagerCount-2:this.pagerCount))},offsetNumber:function(){return Math.floor((this.pagerCount-2)/2)}},created:function(){_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent)},destroyed:function(){_tools.GlobalEvent.off(this,"mousedown")},render:function(t){var e,n=this,a=this.layouts,i=this.loading,s=this.vSize,r=this.align,o=this.background;return t("div",{class:["s-pager",(e={},_defineProperty(e,"size--".concat(s),s),_defineProperty(e,"align--".concat(r),r),_defineProperty(e,"p--background",o),_defineProperty(e,"is--loading",i),e)]},a.map(function(e){return n["render".concat(e)](t)}))},methods:{renderPrevPage:function(e){return e("span",{class:["s-pager--prev-btn",{"is--disabled":this.currentPage<=1}],on:{click:this.prevPageEvent}},[e("i",{class:["s-icon--page-icon",_conf.default.icon.prevPage]})])},renderPrevJump:function(e,t){var n=this,a=this.numList,i=this.currentPage;return e(t||"span",{class:["s-pager--jump-prev",{"is--fixed":!t,"is--disabled":i<=1}],on:{click:function(){return n.jumpPageEvent(Math.max(i-a.length,1))}}},[t?e("i",{class:"s-pager--jump-more s-icon--more"}):null,e("i",{class:["s-pager--jump-icon",_conf.default.icon.jumpPrev]})])},renderNumber:function(e){return e("ul",{class:"s-pager--btn-wrapper"},this.renderPageBtn(e))},renderJumpNumber:function(e){return e("ul",{class:"s-pager--btn-wrapper"},this.renderPageBtn(e,!0))},renderNextJump:function(e,t){var n=this,a=this.numList,i=this.currentPage,s=this.pageCount;return e(t||"span",{class:["s-pager--jump-next",{"is--fixed":!t,"is--disabled":s<=i}],on:{click:function(){return n.jumpPageEvent(Math.min(i+a.length,s))}}},[t?e("i",{class:"s-pager--jump-more s-icon--more"}):null,e("i",{class:["s-pager--jump-icon",_conf.default.icon.jumpNext]})])},renderNextPage:function(e){var t=this.currentPage;return e("span",{class:["s-pager--next-btn",{"is--disabled":this.pageCount<=t}],on:{click:this.nextPageEvent}},[e("i",{class:["s-icon--page-icon",_conf.default.icon.nextPage]})])},renderSizes:function(t){var n=this,e=this.pageSizes,a=this.showSizes,i=this.pageSize,s=this.panelStyle;return t("span",{class:["s-pager--sizes",{"is--active":a}],ref:"sizeBtn"},[t("span",{class:"size--content",on:{click:this.toggleSizePanel}},[t("span","".concat(i).concat(_conf.default.i18n("soul.pager.pagesize"))),t("i",{class:"s-pager--sizes-arrow ".concat(_conf.default.icon.caretBottom)})]),t("div",{class:"s-pager-size--select-wrapper",style:s,ref:"sizePanel"},[t("ul",{class:"s-pager-size--select"},e.map(function(e){return t("li",{class:["size--option",{"is--active":e===i}],on:{click:function(){return n.sizeChangeEvent(e)}}},"".concat(e).concat(_conf.default.i18n("soul.pager.pagesize")))}))])])},renderFullJump:function(e){return this.renderJump(e,!0)},renderJump:function(e,t){var a=this,n=this.currentPage,i=this.pageCount;return e("span",{class:"s-pager--jump"},[t?e("span",{class:"s-pager--goto-text"},_conf.default.i18n("soul.pager.goto")):null,e("input",{class:"s-pager--goto",domProps:{value:n},attrs:{type:"text",autocomplete:"off"},on:{keydown:function(e){if(13===e.keyCode){var t=_xeUtils.default.toNumber(e.target.value),n=t<=0?1:i<=t?i:t;e.target.value=n,a.jumpPageEvent(n)}else 38===e.keyCode?(e.preventDefault(),a.nextPageEvent(e)):40===e.keyCode&&(e.preventDefault(),a.prevPageEvent(e))}}}),t?e("span",{class:"s-pager--classifier-text"},_conf.default.i18n("soul.pager.pageClassifier")):null])},renderPageCount:function(e){var t=this.pageCount;return e("span",{class:"s-pager--count"},[e("span",{class:"s-pager--separator"},"/"),e("span",t)])},renderTotal:function(e){var t=this.total;return e("span",{class:"s-pager--total"},_xeUtils.default.template(_conf.default.i18n("soul.pager.total"),{total:t}))},renderPageBtn:function(a,e){var i=this,t=this.numList,s=this.currentPage,r=this.pageCount,n=this.pagerCount,o=this.offsetNumber,u=[],l=n<r,c=l&&o+1<s,p=l&&s<r-o,g=1;return l&&(g=r-o<=s?Math.max(r-t.length+1,1):Math.max(s-o,1)),e&&c&&u.push(a("li",{class:"s-pager--num-btn",on:{click:function(){return i.jumpPageEvent(1)}}},1),this.renderPrevJump(a,"li")),t.forEach(function(e,t){var n=g+t;n<=r&&u.push(a("li",{class:["s-pager--num-btn",{"is--active":s===n}],on:{click:function(){return i.jumpPageEvent(n)}},key:n},n))}),e&&p&&u.push(this.renderNextJump(a,"li"),a("li",{class:"s-pager--num-btn",on:{click:function(){return i.jumpPageEvent(r)}}},r)),u},getPageCount:function(e,t){return Math.max(Math.ceil(e/t),1)},handleGlobalMousedownEvent:function(e){!this.showSizes||_tools.DomTools.getEventTargetNode(e,this.$refs.sizeBtn).flag||_tools.DomTools.getEventTargetNode(e,this.$refs.sizePanel).flag||this.hideSizePanel()},prevPageEvent:function(){var e=this.currentPage;1<e&&this.jumpPageEvent(Math.max(e-1,1))},nextPageEvent:function(){var e=this.currentPage,t=this.pageCount;e<t&&this.jumpPageEvent(Math.min(e+1,t))},jumpPageEvent:function(e){var t="current-change";e!==this.currentPage&&(this.$emit("update:currentPage",e),_tools.UtilTools.emitEvent(this,t,[e]),this.emitPageChange(t,this.pageSize,e))},sizeChangeEvent:function(e){var t="size-change";e!==this.pageSize&&(this.$emit("update:pageSize",e),_tools.UtilTools.emitEvent(this,t,[e]),this.emitPageChange(t,e,Math.min(this.currentPage,this.getPageCount(this.total,e)))),this.hideSizePanel()},emitPageChange:function(e,t,n){_tools.UtilTools.emitEvent(this,"page-change",[{type:e,pageSize:t,currentPage:n}])},toggleSizePanel:function(){this[this.showSizes?"hideSizePanel":"showSizePanel"]()},showSizePanel:function(){var a=this;this.showSizes=!0,this.$nextTick(function(){var e=a.$refs,t=e.sizeBtn,n=e.sizePanel;a.panelStyle={bottom:"".concat(t.clientHeight+6,"px"),left:"-".concat(n.clientWidth/2-t.clientWidth/2,"px")}})},hideSizePanel:function(){this.showSizes=!1}}};exports.default=_default2;
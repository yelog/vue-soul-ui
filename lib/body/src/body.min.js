"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var scrollProcessTimeout,_xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,l,o){return l in e?Object.defineProperty(e,l,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[l]=o,e}function renderColumn(e,l,o,t,r,n,s,c,i,a,d,u,f){var p,y,b=o._e,x=o.$listeners,m=o.tableData,g=o.height,v=o.overflowX,w=o.scrollXLoad,h=o.scrollYLoad,_=o.highlightCurrentRow,$=o.showOverflow,T=o.align,I=o.cellClassName,C=o.spanMethod,k=o.radioConfig,S=void 0===k?{}:k,P=o.selectConfig,R=void 0===P?{}:P,B=o.treeConfig,L=void 0===B?{}:B,E=o.mouseConfig,q=void 0===E?{}:E,U=o.editConfig,H=o.editRules,D=o.validOpts,O=o.editStore,M=o.validStore,X=d.editRender,Y=d.align,A=d.showOverflow,N=d.columnKey,z=O.actived,K=n?d.fixed!==n:d.fixed&&v,j=_xeUtils.default.isUndefined(A)||_xeUtils.default.isNull(A)?$:A,F=Y||T,G="ellipsis"===j,J="title"===j,Q=!0===j||"tooltip"===j,V=J||Q||G,W={},Z=M.row===c&&M.column===d,ee=H&&("default"===D.message?g||1<m.length:"inline"===D.message),le={"data-index":u},oe=X&&U&&"dblclick"===U.trigger,te={$table:o,$seq:t,seq:r,row:c,rowIndex:i,$rowIndex:a,column:d,columnIndex:u,$columnIndex:f,fixed:n,isHidden:K,level:s,data:m};if(!w&&!h||V||(G=!0),(Q||x["cell-mouseenter"])&&(W.mouseenter=function(e){if(!o._isResize){var l={$table:o,seq:r,row:c,rowIndex:i,$rowIndex:a,column:d,columnIndex:u,$columnIndex:f,fixed:n,isHidden:K,level:s,cell:e.currentTarget};Q&&o.triggerTooltipEvent(e,l),_tools.UtilTools.emitEvent(o,"cell-mouseenter",[l,e])}}),(Q||x["cell-mouseleave"])&&(W.mouseleave=function(e){o._isResize||(o.clostTooltip(),_tools.UtilTools.emitEvent(o,"cell-mouseleave",[{$table:o,seq:r,row:c,rowIndex:i,$rowIndex:a,column:d,columnIndex:u,$columnIndex:f,fixed:n,isHidden:K,level:s,cell:e.currentTarget},e]))}),(q.checked||q.selected)&&(W.mousedown=function(e){o.triggerCellMousedownEvent(e,{$table:o,seq:r,row:c,rowIndex:i,$rowIndex:a,column:d,columnIndex:u,$columnIndex:f,fixed:n,isHidden:K,level:s,cell:e.currentTarget})}),(_||x["cell-click"]||q.checked||X&&U||"row"===S.trigger||"radio"===d.type&&"cell"===S.trigger||"row"===R.trigger||"selection"===d.type&&"cell"===R.trigger||"row"===L.trigger||d.treeNode&&"cell"===L.trigger)&&(W.click=function(e){o.triggerCellClickEvent(e,{$table:o,row:c,rowIndex:i,$rowIndex:a,column:d,columnIndex:u,$columnIndex:f,fixed:n,isHidden:K,level:s,cell:e.currentTarget})}),(oe||x["cell-dblclick"])&&(W.dblclick=function(e){o.triggerCellDBLClickEvent(e,{$table:o,seq:r,row:c,rowIndex:i,$rowIndex:a,column:d,columnIndex:u,$columnIndex:f,fixed:n,isHidden:K,level:s,cell:e.currentTarget})}),C){var re=C(te)||{},ne=re.rowspan,se=void 0===ne?1:ne,ce=re.colspan,ie=void 0===ce?1:ce;if(!se||!ie)return null;le.rowspan=se,le.colspan=ie}return!K&&U&&U.showStatus&&(y=o.hasRowChange(c,d.property)),e("td",{class:["s-body--column",d.id,(p={},_defineProperty(p,"col--".concat(F),F),_defineProperty(p,"col--edit",X),_defineProperty(p,"col--index","index"===d.type),_defineProperty(p,"col--ellipsis",V),_defineProperty(p,"edit--visible",X&&"visible"===X.type),_defineProperty(p,"fixed--hidden",K),_defineProperty(p,"col--dirty",y),_defineProperty(p,"col--actived",U&&X&&z.row===c&&(z.column===d||"row"===U.mode)),_defineProperty(p,"col--valid-error",Z),p),I?_xeUtils.default.isFunction(I)?I(te):I:""],key:N||u,attrs:le,on:W},$&&K?[]:[e("div",{class:["s-cell",{"c--title":J,"c--tooltip":Q,"c--ellipsis":G}],attrs:{title:J?_tools.UtilTools.getCellLabel(c,d,te):null}},d.renderCell(e,te)),ee?Z?e("div",{class:"s-cell--valid",style:M.rule&&M.rule.width?{width:"".concat(M.rule.width,"px")}:null},[e("span",{class:"s-cell--valid-msg"},M.content)]):b():null])}function renderRows(d,u,f,p,y,b,e,x){var m=f.rowKey,g=f.highlightHoverRow,v=f.rowClassName,w=f.treeConfig,h=f.treeExpandeds,_=f.scrollYLoad,$=f.scrollYStore,T=f.editStore,I=f.expandeds,C=f.getRowMapIndex,k=f.getColumnMapIndex,S=[];return e.forEach(function(t,r){var e,l={},n=r,s=n+1;_&&(s+=$.startIndex),n=C(t),g&&(l.mouseenter=function(e){f.triggerHoverEvent(e,{row:t,rowIndex:n})});var o=_tools.UtilTools.getRowPrimaryKey(f,t,n);if(S.push(d("tr",{class:["s-body--row",(e={},_defineProperty(e,"row--level-".concat(y),w),_defineProperty(e,"row--new",-1<T.insertList.indexOf(t)),e),v?_xeUtils.default.isFunction(v)?v({$table:f,seq:s,row:t,rowIndex:n}):v:""],attrs:{"data-rowid":o},key:w?o:m?_xeUtils.default.get(t,m):r,on:l},x.map(function(e,l){var o=k(e);return renderColumn(d,u,f,p,s,b,y,t,n,r,e,o,l)}))),w&&h.length){var c=t[w.children];c&&c.length&&-1<h.indexOf(t)&&S.push.apply(S,renderRows(d,u,f,p?"".concat(p,".").concat(s):"".concat(s),y+1,b,c,x))}else if(I.length&&-1<I.indexOf(t)){var i=x.find(function(e){return"expand"===e.type}),a=k(i);i&&S.push(d("tr",{class:["s-body--expanded-row"],key:"expand_".concat(n),on:l},[d("td",{class:["s-body--expanded-column"],attrs:{colspan:x.length}},[d("div",{class:["s-body--expanded-cell"]},[i.renderData(d,{$table:f,seq:s,row:t,rowIndex:n,column:i,columnIndex:a,fixed:b,level:y})])])]))}}),S}function syncBodyScroll(e,l,o){(l||o)&&(l&&(l.onscroll=null,l.scrollTop=e),o&&(o.onscroll=null,o.scrollTop=e),clearTimeout(scrollProcessTimeout),scrollProcessTimeout=setTimeout(function(){l&&(l.onscroll=l._onscroll),o&&(o.onscroll=o._onscroll)},100))}var _default={name:"STableBody",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},mounted:function(){var e=this.$parent,l=this.$el,o=this.$refs,t=this.fixedType,r=e.elemStore,n="".concat(t||"main","-body-");r["".concat(n,"wrapper")]=l,r["".concat(n,"table")]=o.table,r["".concat(n,"colgroup")]=o.colgroup,r["".concat(n,"list")]=o.tbody,r["".concat(n,"xSpace")]=o.xSpace,r["".concat(n,"ySpace")]=o.ySpace,r["".concat(n,"emptyBlock")]=o.emptyBlock,this.$el.onscroll=this.scrollEvent,this.$el._onscroll=this.scrollEvent},beforeDestroy:function(){this.$el._onscroll=null,this.$el.onscroll=null},render:function(o){var e=this._e,l=this.$parent,t=this.fixedColumn,r=this.fixedType,n=l.tableData,s=l.tableColumn,c=l.showOverflow,i=l.scrollXLoad,a=l.mouseConfig,d=void 0===a?{}:a,u=l.keyboardConfig,f=void 0===u?{}:u;return r&&c?s=t:i&&r&&(s=t),o("div",{class:["s-table--body-wrapper",r?"fixed-".concat(r,"--wrapper"):"body--wrapper"],attrs:{fixed:r},on:{mouseleave:l.clearHoverRow}},[r?e():o("div",{class:"s-body--x-space",ref:"xSpace"}),o("div",{class:"s-body--y-space",ref:"ySpace"}),o("table",{class:"s-table--body",attrs:{cellspacing:0,cellpadding:0,border:0},ref:"table"},[o("colgroup",{ref:"colgroup"},s.map(function(e,l){return o("col",{attrs:{name:e.id},key:l})})),o("tbody",{ref:"tbody"},renderRows(o,this,l,"",0,r,n,s))]),r||!d.checked&&!f.isCut?null:o("div",{class:"s-table--borders"},[d.checked?o("div",{class:"s-table-checked-borders",ref:"checkBorders"},[o("span",{class:"s-table-border-top",ref:"checkTop"}),o("span",{class:"s-table-border-right",ref:"checkRight"}),o("span",{class:"s-table-border-bottom",ref:"checkBottom"}),o("span",{class:"s-table-border-left",ref:"checkLeft"})]):null,f.isCut?o("div",{class:"s-table-copyed-borders",ref:"copyBorders"},[o("span",{class:"s-table-border-top",ref:"copyTop"}),o("span",{class:"s-table-border-right",ref:"copyRight"}),o("span",{class:"s-table-border-bottom",ref:"copyBottom"}),o("span",{class:"s-table-border-left",ref:"copyLeft"})]):null]),r||n.length?null:o("div",{class:"s-table--empty-block",ref:"emptyBlock"},[o("span",{class:"s-table--empty-text"},l.$slots.empty||_conf.default.i18n("vxe.table.emptyText"))])])},methods:{scrollEvent:function(e){var l=this.$parent,o=this.fixedType,t=l.$refs,r=l.scrollXLoad,n=l.scrollYLoad,s=l.lastScrollTop,c=l.lastScrollLeft,i=t.tableHeader,a=t.tableBody,d=t.leftBody,u=t.rightBody,f=i?i.$el:null,p=a.$el,y=d?d.$el:null,b=u?u.$el:null,x=p.scrollTop,m=p.scrollLeft,g=m!==c,v=x!==s;l.lastScrollTop=x,l.lastScrollLeft=m,y&&"left"===o?syncBodyScroll(x=y.scrollTop,p,b):b&&"right"===o?syncBodyScroll(x=b.scrollTop,p,y):(g&&f&&(f.scrollLeft=p.scrollLeft),(y||b)&&(l.checkScrolling(),v&&syncBodyScroll(x,y,b))),r&&g?l.triggerScrollXEvent(e):n&&v&&l.triggerScrollYEvent(e),_tools.UtilTools.emitEvent(l,"scroll",[{type:"body",fixed:o,scrollTop:x,scrollLeft:m,isX:g,isY:v,$table:l},e])}}};exports.default=_default;
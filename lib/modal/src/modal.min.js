"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _conf=_interopRequireDefault(require("../../conf")),_xeUtils=_interopRequireDefault(require("xe-utils")),_queue=_interopRequireDefault(require("./queue")),_tools=require("../../tools");function _interopRequireDefault(t){return t&&t.__esModule?t:{default:t}}function _defineProperty(t,e,o){return e in t?Object.defineProperty(t,e,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[e]=o,t}var cumsumZindex=0,maxZindex=0;function getZIndex(){return maxZindex=_conf.default.modal.zIndex+cumsumZindex++}var _default2={name:"VxeModal",props:{value:Boolean,id:String,type:{type:String,default:"modal"},status:String,top:{type:[Number,String],default:15},title:String,duration:{type:[Number,String],default:function(){return _conf.default.modal.duration}},message:[String,Function],lockView:{type:Boolean,default:function(){return _conf.default.modal.lockView}},lockScroll:Boolean,mask:{type:Boolean,default:function(){return _conf.default.modal.mask}},maskClosable:Boolean,escClosable:Boolean,resize:Boolean,showHeader:{type:Boolean,default:!0},showFooter:{type:Boolean,default:!0},width:[Number,String],height:[Number,String],zIndex:[Number,String],marginSize:{type:[Number,String],default:_conf.default.modal.marginSize},animat:{type:Boolean,default:function(){return _conf.default.modal.animat}},slots:Object,events:Object},data:function(){return{visible:!1,contentVisible:!1,modalTop:0,modalZindex:0,zoomLocat:null}},computed:{vSize:function(){return this.size||this.$parent&&(this.$parent.size||this.$parent.vSize)},isMsg:function(){return"message"===this.type}},watch:{value:function(t){this[t?"open":"close"]()}},created:function(){this.value&&this.open(),this.modalZindex=this.zIndex||getZIndex()},mounted:function(){var t=this.width,e=this.height,o=this.getBox();Object.assign(o.style,{width:t?isNaN(t)?t:"".concat(t,"px"):null,height:e?isNaN(e)?e:"".concat(e,"px"):null}),this.escClosable&&_tools.GlobalEvent.on(this,"keydown",this.handleGlobalKeydownEvent),document.body.appendChild(this.$el)},beforeDestroy:function(){_tools.GlobalEvent.off(this,"keydown"),this.removeMsgQueue(),this.$el.parentNode.removeChild(this.$el)},render:function(e){var t,o=this,i=this.$scopedSlots,s=this.slots,n=void 0===s?{}:s,l=this.vSize,a=this.type,c=this.resize,u=this.animat,d=this.status,r=this.showHeader,h=this.showFooter,m=this.zoomLocat,f=this.modalTop,p=this.contentVisible,v=this.visible,g=this.title,x=this.message,b=this.lockScroll,y=this.lockView,_=this.mask,w=this.isMsg,z=i.default||n.default,k=i.footer||n.footer;return e("div",{class:["s-modal--wrapper","type--".concat(a),(t={},_defineProperty(t,"size--".concat(l),l),_defineProperty(t,"status--".concat(d),d),_defineProperty(t,"is--animat",u),_defineProperty(t,"lock--scroll",b),_defineProperty(t,"lock--view",y),_defineProperty(t,"is--mask",_),_defineProperty(t,"is--visible",p),_defineProperty(t,"active",v),t)],style:{zIndex:this.modalZindex,top:f?"".concat(f,"px"):null},on:{click:this.selfClickEvent}},[e("div",{class:"s-modal--box",on:{mousedown:this.updateZindex},ref:"modalBox"},[r?e("div",{class:"s-modal--header",on:{mousedown:this.mousedownEvent}},[e("span",{class:"s-modal--title"},g?_tools.UtilTools.getFuncText(g):_conf.default.i18n("s.alert.title")),c?e("i",{class:["s-modal--zoom-btn","trigger--btn",m?_conf.default.icon.zoomOut:_conf.default.icon.zoomIn],on:{click:this.zoomInEvent}}):null,e("i",{class:["s-modal--close-btn","trigger--btn",_conf.default.icon.modalClose],on:{click:this.closeEvent}})]):null,e("div",{class:"s-modal--body"},[d?e("div",{class:"s-modal--status-wrapper"},[e("i",{class:["s-modal--status-icon",_conf.default.icon["modal".concat(d.replace(/\b(\w)/,function(t){return t.toUpperCase()}))]]})]):null,e("div",{class:"s-modal--content"},z?z.call(this,{$modal:this},e):_xeUtils.default.isFunction(x)?x.call(this,e):x)]),h?e("div",{class:"s-modal--footer"},k?k.call(this,{$modal:this},e):["confirm"===a?e("s-button",{on:{click:this.cancelEvent}},_conf.default.i18n("s.button.cancel")):null,e("s-button",{props:{type:"primary"},on:{click:this.confirmEvent}},_conf.default.i18n("s.button.confirm"))]):null,!w&&c?e("span",{class:"s-modal--resize"},["wl","wr","swst","sest","st","swlb","selb","sb"].map(function(t){return e("span",{class:"".concat(t,"-resize"),attrs:{"data-type":t},on:{mousedown:o.dragEvent}})})):null])])},methods:{selfClickEvent:function(t){if(this.maskClosable&&t.target===this.$el){this.close("mask")}},updateZindex:function(){this.modalZindex<maxZindex&&(this.modalZindex=getZIndex())},closeEvent:function(t){var e="close";this.$emit(e,{type:e,$modal:this},t),this.close(e)},confirmEvent:function(t){var e="confirm";this.$emit(e,{type:e,$modal:this},t),this.close(e)},cancelEvent:function(t){var e="cancel";this.$emit(e,{type:e,$modal:this},t),this.close(e)},open:function(){var s=this,t=this.$listeners,e=this.events,o=void 0===e?{}:e,i=this.duration,n=this.visible,l=this.isMsg;if(!n){var a={type:"show",$modal:this};this.visible=!0,this.contentVisible=!1,this.updateZindex(),o.show||(this.$emit("input",!0),this.$emit("show",a)),setTimeout(function(){s.contentVisible=!0,!t.show&&o.show&&s.$nextTick(function(){o.show.call(s,a)})},10),l?(this.addMsgQueue(),setTimeout(this.close,_xeUtils.default.toNumber(i))):this.$nextTick(function(){var t=s.marginSize,e=s.getBox(),o=document.documentElement.clientWidth||document.body.clientWidth,i=document.documentElement.clientHeight||document.body.clientHeight;e.style.left="".concat(o/2-e.offsetWidth/2,"px"),e.offsetHeight+e.offsetTop+t>i&&(e.style.top="".concat(t,"px"))})}},addMsgQueue:function(){-1===_queue.default.indexOf(this)&&_queue.default.push(this),this.updateStyle()},removeMsgQueue:function(){var e=this;-1<_queue.default.indexOf(this)&&_xeUtils.default.remove(_queue.default,function(t){return t===e}),this.updateStyle()},updateStyle:function(){this.$nextTick(function(){var e=0;_queue.default.forEach(function(t){e+=_xeUtils.default.toNumber(t.top),t.modalTop=e,e+=t.$refs.modalBox.clientHeight})})},close:function(e){var o=this,t=this.events,i=void 0===t?{}:t,s=this.visible,n=this.isMsg;s&&(n&&this.removeMsgQueue(),this.contentVisible=!1,setTimeout(function(){o.visible=!1;var t={type:e,$modal:o};i.hide?i.hide.call(o,t):(o.$emit("input",!1),o.$emit("hide",t))},200))},handleGlobalKeydownEvent:function(t){27===t.keyCode&&this.close()},getBox:function(){return this.$refs.modalBox},zoomInEvent:function(t){var e=this.$listeners,o=this.marginSize,i=this.zoomLocat,s=this.events,n=void 0===s?{}:s,l=_tools.DomTools.getDomNode(),a=l.visibleHeight,c=l.visibleWidth,u=this.getBox(),d="min";i?(this.zoomLocat=null,Object.assign(u.style,{top:"".concat(i.top,"px"),left:"".concat(i.left,"px"),width:"".concat(i.width,"px"),height:"".concat(i.height,"px")})):(d="max",this.zoomLocat={top:u.offsetTop,left:u.offsetLeft,width:u.clientWidth,height:u.clientHeight},Object.assign(u.style,{top:"".concat(o,"px"),left:"".concat(o,"px"),width:"".concat(c-2*o,"px"),height:"".concat(a-2*o,"px")}));var r={type:d,$modal:this};e.zoom?this.$emit("zoom",r,t):n.zoom&&n.zoom.call(this,r,t)},mousedownEvent:function(t){var e=this,u=this.marginSize,d=this.getBox();if(0===t.button&&!_tools.DomTools.getEventTargetNode(t,d,"trigger--btn").flag){t.preventDefault();var o=document.onmousemove,i=document.onmouseup,r=t.clientX-d.offsetLeft,h=t.clientY-d.offsetTop,s=_tools.DomTools.getDomNode(),m=s.visibleHeight,f=s.visibleWidth;document.onmousemove=function(t){t.preventDefault();var e=d.offsetWidth,o=d.offsetHeight,i=u,s=f-e-u,n=u,l=m-o-u,a=t.clientX-r,c=t.clientY-h;s<a&&(a=s),a<i&&(a=i),l<c&&(c=l),c<n&&(c=n),d.style.left="".concat(a,"px"),d.style.top="".concat(c,"px"),d.className=d.className.replace(/\s?is--drag/,"")+" is--drag"},document.onmouseup=function(t){document.onmousemove=o,document.onmouseup=i,e.$nextTick(function(){d.className=d.className.replace(/\s?is--drag/,"")})}}},dragEvent:function(t){var n=this;t.preventDefault();var l=this.$listeners,a=this.marginSize,e=this.events,c=void 0===e?{}:e,o=_tools.DomTools.getDomNode(),u=o.visibleHeight,d=o.visibleWidth,r=t.target.dataset.type,h=d-20,m=u-20,f=this.getBox(),i=document.onmousemove,s=document.onmouseup,p=f.clientWidth,v=f.clientHeight,g=t.clientX,x=t.clientY,b=f.offsetTop,y=f.offsetLeft,_={type:"resize",$modal:this};document.onmousemove=function(t){var e,o,i,s;switch(t.preventDefault(),r){case"wl":i=(e=g-t.clientX)+p,a<y-e&&340<i&&(f.style.width="".concat(i<h?i:h,"px"),f.style.left="".concat(y-e,"px"));break;case"swst":e=g-t.clientX,o=x-t.clientY,i=e+p,s=o+v,a<y-e&&340<i&&(f.style.width="".concat(i<h?i:h,"px"),f.style.left="".concat(y-e,"px")),a<b-o&&200<s&&(f.style.height="".concat(s<m?s:m,"px"),f.style.top="".concat(b-o,"px"));break;case"swlb":e=g-t.clientX,o=t.clientY-x,i=e+p,s=o+v,a<y-e&&340<i&&(f.style.width="".concat(i<h?i:h,"px"),f.style.left="".concat(y-e,"px")),b+s+a<u&&200<s&&(f.style.height="".concat(s<m?s:m,"px"));break;case"st":o=x-t.clientY,s=v+o,a<b-o&&200<s&&(f.style.height="".concat(s<m?s:m,"px"),f.style.top="".concat(b-o,"px"));break;case"wr":e=t.clientX-g,y+(i=e+p)+a<d&&340<i&&(f.style.width="".concat(i<h?i:h,"px"));break;case"sest":e=t.clientX-g,s=(o=x-t.clientY)+v,y+(i=e+p)+a<d&&340<i&&(f.style.width="".concat(i<h?i:h,"px")),a<b-o&&200<s&&(f.style.height="".concat(s<m?s:m,"px"),f.style.top="".concat(b-o,"px"));break;case"selb":e=t.clientX-g,s=(o=t.clientY-x)+v,y+(i=e+p)+a<d&&340<i&&(f.style.width="".concat(i<h?i:h,"px")),b+s+a<u&&200<s&&(f.style.height="".concat(s<m?s:m,"px"));break;case"sb":o=t.clientY-x,b+(s=o+v)+a<u&&200<s&&(f.style.height="".concat(s<m?s:m,"px"))}f.className=f.className.replace(/\s?is--drag/,"")+" is--drag",l.zoom?n.$emit("zoom",_,t):c.zoom&&c.zoom.call(n,_,t)},document.onmouseup=function(t){document.onmousemove=i,document.onmouseup=s,setTimeout(function(){f.className=f.className.replace(/\s?is--drag/,"")},50)}}}};exports.default=_default2;
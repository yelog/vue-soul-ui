"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _conf=_interopRequireDefault(require("../../conf")),_xeUtils=_interopRequireDefault(require("xe-utils")),_msgQueue=_interopRequireDefault(require("./msgQueue")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var _default2={name:"SMessage",props:{value:Boolean,id:String,type:String,status:String,top:{type:Number,default:15},title:String,duration:{type:Number,default:function(){return _conf.default.message.duration}},message:[String,Function],lockView:{type:Boolean,default:function(){return _conf.default.message.lockView}},lockScroll:{type:Boolean,default:function(){return _conf.default.message.lockScroll}},mask:{type:Boolean,default:function(){return _conf.default.message.mask}},maskClosable:Boolean,zIndex:{type:Number,default:function(){return _conf.default.message.zIndex}},animat:{type:Boolean,default:function(){return _conf.default.message.animat}}},data:function(){return{visible:!1,contentVisible:!1,beforeLockStyle:null,msgTop:0}},computed:{vSize:function(){return this.size||this.$parent&&(this.$parent.size||this.$parent.vSize)},isMsg:function(){return"message"===this.type}},watch:{value:function(e){this[e?"open":"close"]()}},created:function(){this.value&&this.open()},mounted:function(){document.body.appendChild(this.$el)},beforeDestroy:function(){this.removeMsgQueue(),this.$el.parentNode.removeChild(this.$el)},render:function(e){var t,i=this.vSize,s=this.type,n=this.animat,o=this.zIndex,u=this.status,l=this.msgTop,c=this.contentVisible,a=this.visible,r=this.title,f=this.message,d=this.lockView,m=this.mask,h=this.isMsg;return e("div",{class:["s-msg--wrapper","type--".concat(s),(t={},_defineProperty(t,"size--".concat(i),i),_defineProperty(t,"msg--".concat(u),u),_defineProperty(t,"is--animat",n),_defineProperty(t,"lock--view",d),_defineProperty(t,"is--mask",m),_defineProperty(t,"is--visible",c),_defineProperty(t,"active",a),t)],style:{zIndex:o,top:l?"".concat(l,"px"):null},on:{click:this.selfClickEvent}},[e("div",{class:"s-msg--box",ref:"msgBox"},[h?null:e("div",{class:"s-msg--header",on:{mousedown:this.mousedownEvent}},[e("span",{class:"s-msg--title"},r?_tools.UtilTools.getFuncText(r):_conf.default.i18n("soul.alert.title")),e("i",{class:["s-msg--close-btn",_conf.default.icon.msgClose],on:{click:this.closeEvent}})]),e("div",{class:"s-msg--body"},[u?e("div",{class:"s-msg--status-wrapper"},[e("i",{class:["s-msg--status-icon",_conf.default.icon["msg".concat(u.replace(/\b(\w)/,function(e){return e.toUpperCase()}))]]})]):null,e("div",{class:"s-msg--content"},this.$slots.default||(_xeUtils.default.isFunction(f)?f.call(this,e):f))]),h?null:e("div",{class:"s-msg--footer"},["confirm"===s?e("s-button",{on:{click:this.cancelEvent}},_conf.default.i18n("soul.button.cancel")):null,e("s-button",{props:{type:"primary"},on:{click:this.confirmEvent}},_conf.default.i18n("soul.button.confirm"))])])])},methods:{selfClickEvent:function(e){if(this.maskClosable&&e.target===this.$el){this.close("mask")}},closeEvent:function(e){var t="close";this.$emit(t,e),this.close(t)},confirmEvent:function(e){var t="confirm";this.$emit(t,e),this.close(t)},cancelEvent:function(e){var t="cancel";this.$emit(t,e),this.close(t)},open:function(){var e=this,t=this.duration,i=this.visible,s=this.lockScroll,n=this._handleCustom,o=this.isMsg;if(!i){if(this.visible=!0,this.contentVisible=!1,setTimeout(function(){e.contentVisible=!0},10),s){var u=document.body;this.beforeLockStyle={paddingRight:u.style.paddingRight,overflow:u.style.overflow},u.style.paddingRight="".concat(window.innerWidth-(document.documentElement.clientWidth||document.body.clientWidth),"px"),u.style.overflow="hidden"}n||(this.$emit("input",!0),this.$emit("show")),o&&(this.addMsgQueue(),setTimeout(this.close,t))}},addMsgQueue:function(){-1===_msgQueue.default.indexOf(this)&&_msgQueue.default.push(this),this.updateStyle()},removeMsgQueue:function(){var t=this;-1<_msgQueue.default.indexOf(this)&&_xeUtils.default.remove(_msgQueue.default,function(e){return e===t}),this.updateStyle()},updateStyle:function(){this.$nextTick(function(){var t=0;_msgQueue.default.forEach(function(e){t+=e.top,e.msgTop=t,t+=e.$refs.msgBox.clientHeight})})},close:function(e){var t=this,i=this.visible,s=this.lockScroll,n=this.beforeLockStyle,o=this.isMsg;i&&(o&&this.removeMsgQueue(),this.contentVisible=!1,setTimeout(function(){t.visible=!1,s&&Object.assign(document.body.style,n),t._handleCustom?t._handleCustom(e):(t.$emit("input",!1),t.$emit("hide",e))},200))},mousedownEvent:function(e){var t=this;if(0===e.button){e.preventDefault();var a=this.$refs.msgBox,i=document.onmousemove,s=document.onmouseup,r=e.clientX-a.offsetLeft,f=e.clientY-a.offsetTop;document.onmousemove=function(e){e.preventDefault();var t=document.documentElement.clientWidth||document.body.clientWidth,i=document.documentElement.clientHeight||document.body.clientHeight,s=a.offsetWidth,n=s/2,o=t-s/2,u=i-a.offsetHeight,l=e.clientX-r,c=e.clientY-f;o<l&&(l=o),l<n&&(l=n),u<c&&(c=u),c<0&&(c=0),a.style.left="".concat(l,"px"),a.style.top="".concat(c,"px"),a.className=a.className.replace(/\s?drag-move/,"")+" drag-move"},document.onmouseup=function(e){document.onmousemove=i,document.onmouseup=s,t.$nextTick(function(){a.className=a.className.replace(/\s?drag-move/,"")})}}}}};exports.default=_default2;
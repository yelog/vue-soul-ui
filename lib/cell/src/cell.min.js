"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=exports.Cell=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tableCore=require("../../table-core"),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,r,t){return r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}var Cell={createColumn:function(e,r){var t=r.type,n=r.sortable,l=r.remoteSort,o=r.filters,d=r.editRender,i=r.treeNode,a=e.selectConfig,c=e.treeConfig&&i,s={renderHeader:this.renderHeader,renderCell:c?this.renderTreeCell:this.renderCell};switch(t){case"index":s.renderHeader=this.renderIndexHeader,s.renderCell=c?this.renderTreeIndexCell:this.renderIndexCell;break;case"radio":s.renderHeader=this.renderRadioHeader,s.renderCell=c?this.renderTreeRadioCell:this.renderRadioCell;break;case"selection":s.renderHeader=this.renderSelectionHeader,s.renderCell=a&&a.checkField?c?this.renderTreeSelectionCellByProp:this.renderSelectionCellByProp:c?this.renderTreeSelectionCell:this.renderSelectionCell;break;case"expand":s.renderCell=this.renderExpandCell,s.renderData=this.renderExpandData;break;default:d?(s.renderHeader=this.renderEditHeader,s.renderCell=e.editConfig&&"cell"===e.editConfig.mode?c?this.renderTreeCellEdit:this.renderCellEdit:c?this.renderTreeRadioCell:this.renderRowEdit):o&&o.length&&(n||l)?s.renderHeader=this.renderSortAndFilterHeader:n||l?s.renderHeader=this.renderSortHeader:o&&o.length&&(s.renderHeader=this.renderFilterHeader)}return _tools.UtilTools.getColumnConfig(r,s)},renderHeader:function(e,r){var t=r.column,n=t.slots,l=t.own;return n&&n.header?n.header(r,e):[_tools.UtilTools.formatText(_tools.UtilTools.getFuncText(l.title||l.label),1)]},renderCell:function(e,r){var t,n=r.$table,l=r.row,o=r.column,d=o.slots,i=o.own,a=i.editRender||i.cellRender;if(d&&d.default)return d.default(r,e);if(a){var c=i.editRender?"renderCell":"renderDefault",s=_tableCore.Renderer.get(a.name);if(s&&s[c])return s[c].call(n,e,a,r,{$excel:n.$parent,$table:n,$column:o})}return t=_tools.UtilTools.getCellLabel(l,o,r),[_tools.UtilTools.formatText(t,1)]},renderTreeCell:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderCell.call(this,e,r))},renderTreeIcon:function(e,r){var t=_conf.default.icon,n=r.$table,l=n.treeConfig,o=n.treeExpandeds,d=r.row,i=r.level,a=l.children,c=l.indent,s=l.trigger,u=d[a],f={};return s&&"default"!==s||(f.click=function(e){return n.triggerTreeExpandEvent(e,r)}),[e("span",{class:"s-tree--indent",style:{width:"".concat(i*(c||16),"px")}}),e("span",{class:["s-tree-wrapper",{"is--active":-1<o.indexOf(d)}],on:f},u&&u.length?[e("i",{class:"s-tree--node-btn ".concat(t.tree)})]:[])]},renderIndexHeader:function(e,r){var t=r.column,n=t.slots,l=t.own;return n&&n.header?n.header(r,e):[_tools.UtilTools.formatText(_tools.UtilTools.getFuncText(l.title||l.label||"#"),1)]},renderIndexCell:function(e,r){var t=r.$table,n=r.column,l=t.startIndex,o=n.slots,d=n.indexMethod;if(o&&o.default)return o.default(r,e);var i=r.$seq,a=r.seq,c=r.level;return[_tools.UtilTools.formatText(d?d(r):c?"".concat(i,".").concat(a):l+a,1)]},renderTreeIndexCell:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderIndexCell(e,r))},renderRadioHeader:function(e,r){var t=r.column,n=t.slots,l=t.own;return n&&n.header?n.header(r,e):[_tools.UtilTools.formatText(_tools.UtilTools.getFuncText(l.title||l.label),1)]},renderRadioCell:function(e,r){var t,n=r.$table,l=r.column,o=r.isHidden,d=n.vSize,i=n.radioConfig,a=void 0===i?{}:i,c=l.slots,s=a.labelField,u=a.checkMethod,f=!!u;if(c&&c.default)return c.default(r,e);var C=n.selectRow,h=r.row,p={attrs:{type:"radio",name:"s-radio--".concat(n.id)}};return o||(u&&(f=!u(r),p.attrs.disabled=f),p.domProps={checked:h===C},p.on={change:function(e){n.triggerRadioRowEvent(e,r)}}),[e("label",{class:["s-radio",(t={},_defineProperty(t,"size--".concat(d),d),_defineProperty(t,"is--disabled",f),t)]},[e("input",p),e("span",{class:"s-radio--icon"}),s?e("span",{class:"s-radio--label"},_xeUtils.default.get(h,s)):null])]},renderTreeRadioCell:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderRadioCell(e,r))},renderSelectionHeader:function(e,r){var t,n=r.$table,l=r.column,o=r.isHidden,d=n.vSize,i=n.selectConfig,a=l.slots,c=l.own,s=c.title||c.label,u={attrs:{type:"checkbox"}};return a&&a.header?a.header(r,e):i&&(i.checkStrictly?!i.showHeader:!1===i.showHeader)?[]:(o||(u.domProps={checked:n.isAllSelected},u.on={change:function(e){n.triggerCheckAllEvent(e,e.target.checked)}}),[e("label",{class:["s-checkbox",(t={},_defineProperty(t,"size--".concat(d),d),_defineProperty(t,"is--indeterminate",n.isIndeterminate),t)]},[e("input",u),e("span",{class:"s-checkbox--icon"}),s?e("span",{class:"s-checkbox--label"},_tools.UtilTools.getFuncText(s)):null])])},renderSelectionCell:function(e,r){var t,n=r.$table,l=r.row,o=r.column,d=r.isHidden,i=n.vSize,a=n.selectConfig,c=void 0===a?{}:a,s=n.treeConfig,u=n.treeIndeterminates,f=c.labelField,C=c.checkMethod,h=o.slots,p=!1,b=!!C,x={attrs:{type:"checkbox"}};return h&&h.default?h.default(r,e):(d||(C&&(b=!C(r),x.attrs.disabled=b),s&&(p=-1<u.indexOf(l)),x.domProps={checked:-1<n.selection.indexOf(l)},x.on={change:function(e){n.triggerCheckRowEvent(e,r,e.target.checked)}}),[e("label",{class:["s-checkbox",(t={},_defineProperty(t,"size--".concat(i),i),_defineProperty(t,"is--indeterminate",p),_defineProperty(t,"is--disabled",b),t)]},[e("input",x),e("span",{class:"s-checkbox--icon"}),f?e("span",{class:"s-checkbox--label"},_xeUtils.default.get(l,f)):null])])},renderTreeSelectionCell:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderSelectionCell(e,r))},renderSelectionCellByProp:function(e,r){var t,n=r.$table,l=r.row,o=r.column,d=r.isHidden,i=n.vSize,a=n.selectConfig,c=void 0===a?{}:a,s=n.treeConfig,u=n.treeIndeterminates,f=c.labelField,C=c.checkField,h=c.checkMethod,p=o.slots,b=!1,x=!!h,g={attrs:{type:"checkbox"}};return p&&p.default?p.default(r,e):(d||(h&&(x=!h(r),g.attrs.disabled=x),s&&(b=-1<u.indexOf(l)),g.domProps={checked:_xeUtils.default.get(l,C)},g.on={change:function(e){n.triggerCheckRowEvent(e,r,e.target.checked)}}),[e("label",{class:["s-checkbox",(t={},_defineProperty(t,"size--".concat(i),i),_defineProperty(t,"is--indeterminate",b),_defineProperty(t,"is--disabled",x),t)]},[e("input",g),e("span",{class:"s-checkbox--icon"}),f?e("span",{class:"s-checkbox--label"},_xeUtils.default.get(l,f)):null])])},renderTreeSelectionCellByProp:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderSelectionCellByProp(e,r))},renderExpandCell:function(e,r){var t=r.$table,n=!1;return r.isHidden||(n=-1<t.expandeds.indexOf(r.row)),[e("span",{class:["s-table--expanded",{"expand--active":n}],on:{click:function(e){t.triggerRowExpandEvent(e,r)}}},[e("i",{class:"s-table--expand-icon"})])]},renderExpandData:function(e,r){var t=r.column.slots;return t&&t.default?t.default(r,e):[]},renderSortAndFilterHeader:function(e,r){return Cell.renderHeader(e,r).concat(Cell.renderSortIcon(e,r)).concat(Cell.renderFilterIcon(e,r))},renderSortHeader:function(e,r){return Cell.renderHeader(e,r).concat(Cell.renderSortIcon(e,r))},renderSortIcon:function(e,r){var t=_conf.default.icon,n=r.$table,l=r.column;return[e("span",{class:"s-sort-wrapper"},[e("i",{class:["s-sort--asc-btn",t.sortAsc,{"sort--active":"asc"===l.order}],on:{click:function(e){n.triggerSortEvent(e,l,r,"asc")}}}),e("i",{class:["s-sort--desc-btn",t.sortDesc,{"sort--active":"desc"===l.order}],on:{click:function(e){n.triggerSortEvent(e,l,r,"desc")}}})])]},renderFilterHeader:function(e,r){return Cell.renderHeader(e,r).concat(Cell.renderFilterIcon(e,r))},renderFilterIcon:function(e,r){var t=_conf.default.icon,n=r.$table,l=r.column,o=n.filterStore;return[e("span",{class:["s-filter-wrapper",{"is--active":o.visible&&o.column===l}]},[e("i",{class:"s-filter--btn ".concat(t.filter),on:{click:function(e){n.triggerFilterEvent(e,r.column,r)}}})])]},renderEditHeader:function(e,r){var t,n=_conf.default.icon,l=r.$table,o=r.column,d=l.editRules,i=l.editConfig,a=o.sortable,c=o.remoteSort,s=o.filters;if(d){var u=_xeUtils.default.get(d,r.column.property);u&&(t=u.some(function(e){return e.required}))}return[t?e("i",{class:"s-required-icon"}):null,i&&!1===i.showIcon?null:e("i",{class:"s-edit-icon ".concat(n.edit)})].concat(Cell.renderHeader(e,r)).concat(a||c?Cell.renderSortIcon(e,r):[]).concat(s&&s.length?Cell.renderFilterIcon(e,r):[])},renderRowEdit:function(e,r){var t=r.$table.editStore.actived;return Cell.runRenderer(e,r,this,t&&t.row===r.row)},renderTreeRowEdit:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderRowEdit(e,r))},renderCellEdit:function(e,r){var t=r.$table.editStore.actived;return Cell.runRenderer(e,r,this,t&&t.row===r.row&&t.column===r.column)},renderTreeCellEdit:function(e,r){return Cell.renderTreeIcon(e,r).concat(Cell.renderCellEdit(e,r))},runRenderer:function(e,r,t,n){var l=r.$table,o=r.row,d=r.column,i=d.slots,a=d.own,c=d.formatter,s=a.editRender,u=_tableCore.Renderer.get(s.name);return"visible"===s.type||n?i&&i.edit?i.edit(r,e):u&&u.renderEdit?u.renderEdit.call(l,e,s,r,{$excel:l.$parent,$table:l,$column:d}):[]:i&&i.default?i.default(r,e):c?[_tools.UtilTools.formatText(_tools.UtilTools.getCellLabel(o,d,r),1)]:Cell.renderCell.call(t,e,r)}},_default=exports.Cell=Cell;exports.default=_default;
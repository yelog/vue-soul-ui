"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}var rowHeight=24;function getCursorPosition(e){var t={text:"",start:0,end:0};if(e.setSelectionRange)t.start=e.selectionStart,t.end=e.selectionEnd,t.text=t.start!==t.end?e.value.substring(t.start,t.end):"";else if(document.selection){var o=0,r=document.selection.createRange(),a=document.body.createTextRange();for(a.moveToElementText(e),t.text=r.text,t.bookmark=r.getBookmark();a.compareEndPoints("StartToStart",r)<0&&0!==r.moveStart("character",-1);o++)"\n"===e.value.charAt(o)&&o++;t.start=o,t.end=t.text.length+t.start}return t}function setCursorPosition(e,t){if(e.setSelectionRange)e.focus(),e.setSelectionRange(t.start,t.end);else if(e.createTextRange){var o=e.createTextRange();e.value.length===t.start?o.collapse(!1):o.moveToBookmark(t.bookmark),o.select()}}var _default={cell:{autofocus:".vxe-textarea",renderEdit:function(e,t,o,r){var a=r.$excel.excelStore.uploadRows,n=o.row,l=o.column,s=l.model;return[e("div",{class:"vxe-input--wrapper vxe-excel-cell",style:{height:"".concat(l.renderHeight-1,"px")}},[e("textarea",{class:"vxe-textarea",style:{width:"".concat(l.renderWidth,"px")},domProps:{value:s.value},on:{input:function(e){var t=e.target;s.update=!0,s.value=t.value,t.scrollHeight>t.offsetHeight&&(-1===a.indexOf(n)?t.style.width="".concat(t.offsetWidth+20,"px"):t.style.height="".concat(t.scrollHeight,"px"))},change:function(e){-1===a.indexOf(n)&&a.push(n)},keydown:function(e){var t=e.target;if(e.altKey&&13===e.keyCode){e.preventDefault(),e.stopPropagation();var o=getCursorPosition(t),r=o.end,a=t.value;a="".concat(a.slice(0,r),"\n").concat(a.slice(r,a.length)),t.value=a,s.update=!0,s.value=a,t.style.height="".concat((Math.floor(t.offsetHeight/rowHeight)+1)*rowHeight,"px"),setTimeout(function(){o.start=o.end=++r,setCursorPosition(t,o)})}}}})])]},renderCell:function(e,t,o){var r=o.row,a=o.column;return[e("span",{domProps:{innerHTML:_xeUtils.default.escape(_tools.UtilTools.getCellValue(r,a)).replace(/\n/g,"<br>")}})]}}};exports.default=_default;
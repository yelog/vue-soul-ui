"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,l,o){return l in e?Object.defineProperty(e,l,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[l]=o,e}var getAllColumns=function l(e){var o=[];return e.forEach(function(e){e.visible&&(e.children&&e.children.length&&e.children.some(function(e){return e.visible})?(o.push(e),o.push.apply(o,l(e.children))):o.push(e))}),o},convertToRows=function(e){var n=1;e.forEach(function(e){e.level=1,function l(o,e){if(e&&(o.level=e.level+1,n<o.level&&(n=o.level)),o.children&&o.children.length&&o.children.some(function(e){return e.visible})){var t=0;o.children.forEach(function(e){e.visible&&(l(e,o),t+=e.colSpan)}),o.colSpan=t}else o.colSpan=1}(e)});for(var l=[],o=0;o<n;o++)l.push([]);return getAllColumns(e).forEach(function(e){e.children&&e.children.length&&e.children.some(function(e){return e.visible})?e.rowSpan=1:e.rowSpan=n-e.level+1,l[e.level-1].push(e)}),l},_default={name:"STableHeader",props:{tableData:Array,tableColumn:Array,visibleColumn:Array,collectColumn:Array,fixedColumn:Array,size:String,fixedType:String,isGroup:Boolean},data:function(){return{headerColumn:[]}},watch:{tableColumn:function(){this.uploadColumn()}},created:function(){this.uploadColumn()},mounted:function(){var e=this.$parent,l=this.$el,o=this.$refs,t=this.fixedType,n=e.elemStore,i="".concat(t||"main","-header-");n["".concat(i,"wrapper")]=l,n["".concat(i,"table")]=o.table,n["".concat(i,"colgroup")]=o.colgroup,n["".concat(i,"list")]=o.thead,n["".concat(i,"x-space")]=o.xSpace,n["".concat(i,"repair")]=o.repair},render:function(b){var g=this,e=this._e,$=this.$parent,_=this.fixedType,l=this.headerColumn,o=this.tableColumn,t=this.fixedColumn,C=$.$listeners,y=$.resizable,w=$.border,I=$.columnKey,n=$.headerRowClassName,T=$.headerCellClassName,z=$.showHeaderOverflow,S=$.headerAlign,P=$.align,k=$.highlightCurrentColumn,i=$.mouseConfig,E=void 0===i?{}:i,r=$.scrollXLoad,D=$.overflowX,R=$.getColumnIndex,A=$.sortOpts;return r&&_&&(o=t),b("div",{class:["s-table--header-wrapper",_?"fixed-".concat(_,"--wrapper"):"body--wrapper"]},[_?e():b("div",{class:"s-body--x-space",ref:"xSpace"}),b("table",{class:"s-table--header",attrs:{cellspacing:0,cellpadding:0,border:0},ref:"table"},[b("colgroup",{ref:"colgroup"},o.map(function(e,l){return b("col",{attrs:{name:e.id},key:l})}).concat([b("col",{attrs:{name:"col-gutter"}})])),b("thead",{ref:"thead"},l.map(function(e,v){return b("tr",{class:["s-header--row",n?_xeUtils.default.isFunction(n)?n({$table:$,$rowIndex:v,fixed:_}):n:""]},e.map(function(l,o){var e,t=l.showHeaderOverflow,n=l.headerAlign,i=l.align,r=l.children&&l.children.length,a=_?l.fixed!==_&&!r:l.fixed&&D,s=_xeUtils.default.isUndefined(t)||_xeUtils.default.isNull(t)?z:t,c=n||i||S||P,d="ellipsis"===s,u="title"===s,f="tooltip"===s,m=!0===s||"complete"===s,h=m||u||f||d,p={},x=R(l);return(u||f||m)&&(p.mouseover=function(e){$._isResize||(u?_tools.DomTools.updateCellTitle(e):m?$.triggerCompleteEvent(e,{$table:$,$rowIndex:v,column:l,columnIndex:x,$columnIndex:o,locationType:"header",fixed:_}):f&&$.triggerHeaderTooltipEvent(e,{$table:$,$rowIndex:v,column:l,columnIndex:x,$columnIndex:o,fixed:_}))}),(f||m)&&(p.mouseleave=function(e){$._isResize||(m?$.closeComplete(event):f&&$.clostTooltip())}),(k||C["header-cell-click"]||E.checked||"cell"===A.trigger)&&(p.click=function(e){return $.triggerHeaderCellClickEvent(e,{$table:$,$rowIndex:v,column:l,columnIndex:x,$columnIndex:o,fixed:_,cell:e.currentTarget})}),C["header-cell-dblclick"]&&(p.dblclick=function(e){return _tools.UtilTools.emitEvent($,"header-cell-dblclick",[{$table:$,$rowIndex:v,column:l,columnIndex:x,$columnIndex:o,fixed:_,cell:e.currentTarget},e])}),E.checked&&(p.mousedown=function(e){return $.triggerHeaderCellMousedownEvent(e,{$table:$,$rowIndex:v,column:l,columnIndex:x,$columnIndex:o,fixed:_,cell:e.currentTarget})}),b("th",{class:["s-header--column",l.id,(e={},_defineProperty(e,"col--".concat(c),c),_defineProperty(e,"col--fixed",l.fixed),_defineProperty(e,"col--index","index"===l.type),_defineProperty(e,"col--group",r),_defineProperty(e,"col--ellipsis",h),_defineProperty(e,"fixed--hidden",a),_defineProperty(e,"is--sortable",l.sortable),_defineProperty(e,"is--filter",l.filters.length),_defineProperty(e,"filter--active",l.filters.some(function(e){return e.checked})),e),T?_xeUtils.default.isFunction(T)?T({$table:$,$rowIndex:v,column:l,columnIndex:x,$columnIndex:o,fixed:_}):T:""],attrs:{"data-colid":l.id,colspan:l.colSpan,rowspan:l.rowSpan},on:p,key:I||r?l.id:x},[b("div",{class:["s-cell",{"c--title":u,"c--tooltip":f,"c--ellipsis":d}]},l.renderHeader(b,{$table:$,$rowIndex:v,column:l,columnIndex:x,$columnIndex:o,fixed:_,isHidden:a})),!a&&!r&&(_xeUtils.default.isBoolean(l.resizable)?l.resizable:y)?b("div",{class:["s-resizable",{"is--line":!w}],on:{mousedown:function(e){return g.resizeMousedown(e,{$table:$,$rowIndex:v,column:l,columnIndex:x,$columnIndex:o,fixed:_,isHidden:a})}}}):null])}).concat([b("th",{class:"col--gutter"})]))}))]),b("div",{class:"s-table--repair",ref:"repair"})])},methods:{uploadColumn:function(){this.headerColumn=this.isGroup?convertToRows(this.collectColumn):[this.$parent.scrollXLoad&&this.fixedType?this.fixedColumn:this.tableColumn]},resizeMousedown:function(e,l){var o=l.column,t=this.$parent,n=this.$el,i=this.fixedType,r=t.$refs,a=r.tableBody,s=r.leftContainer,c=r.rightContainer,d=r.resizeBar,u=e.target,f=e.clientX,m=u.parentNode,h=0,p=a.$el,x=_tools.DomTools.getOffsetPos(u,n),v=u.clientWidth,b=x.left-m.clientWidth+v+36,g=x.left+Math.floor(v/2),$=document.onmousemove,_=document.onmouseup,C="left"===i,y="right"===i,w=0;if(C||y){for(var I=C?"nextElementSibling":"previousElementSibling",T=m[I];T&&!_tools.DomTools.hasClass(T,"fixed--hidden");)_tools.DomTools.hasClass(T,"col--group")||(w+=T.offsetWidth),T=T[I];y&&c&&(g=c.offsetLeft+w)}var z=function(e){e.stopPropagation(),e.preventDefault();var l=e.clientX-f,o=g+l,t=i?0:p.scrollLeft;C?o=Math.min(o,(c?c.offsetLeft:p.clientWidth)-w-36):y&&(b=(s?s.clientWidth:0)+w+36,o=Math.min(o,g+m.clientWidth-36)),h=Math.max(o,b),d.style.left="".concat(h-t,"px")};t._isResize=!0,_tools.DomTools.addClass(t.$el,"c--resize"),d.style.display="block",document.onmousemove=z,document.onmouseup=function(e){document.onmousemove=$,document.onmouseup=_,o.resizeWidth=o.renderWidth+(y?g-h:h-g),d.style.display="none",t._isResize=!1,t._lastResizeTime=Date.now(),t.analyColumnWidth(),t.recalculate(!0),_tools.DomTools.removeClass(t.$el,"c--resize"),t.$toolbar&&t.$toolbar.updateResizable(),_tools.UtilTools.emitEvent(t,"resizable-change",[l])},z(e)}}};exports.default=_default;
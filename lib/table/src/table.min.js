"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils/methods/xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_tableCore=_interopRequireDefault(require("../../table-core")),_tools=require("../../tools"),_methods=_interopRequireDefault(require("./methods"));function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function renderFixed(e,t,o){var l=t.tableData,i=t.tableColumn,n=t.visibleColumn,r=t.collectColumn,s=t.isGroup,a=t.vSize,u=t.showHeader,f=t.showFooter,d=t.columnStore,h=t.footerData,c=d["".concat(o,"List")];return e("div",{class:"s-table--fixed-".concat(o,"-wrapper"),ref:"".concat(o,"Container")},[u?e("s-table-header",{props:{fixedType:o,tableData:l,tableColumn:i,visibleColumn:n,collectColumn:r,size:a,fixedColumn:c,isGroup:s},ref:"".concat(o,"Header")}):null,e("s-table-body",{props:{fixedType:o,tableData:l,tableColumn:i,visibleColumn:n,collectColumn:r,fixedColumn:c,size:a,isGroup:s},ref:"".concat(o,"Body")}),f?e("s-table-footer",{props:{fixedType:o,footerData:h,tableColumn:i,visibleColumn:n,size:a,fixedColumn:c},ref:"".concat(o,"Footer")}):null])}var _default2={name:"STable",props:{data:Array,customs:Array,height:[Number,String],maxHeight:[Number,String],resizable:{type:Boolean,default:function(){return _conf.default.resizable}},stripe:{type:Boolean,default:function(){return _conf.default.stripe}},border:{type:Boolean,default:function(){return _conf.default.border}},size:{type:String,default:function(){return _conf.default.size}},fit:{type:Boolean,default:function(){return _conf.default.fit}},loading:Boolean,loadingConfig:Object,align:{type:String,default:function(){return _conf.default.align}},headerAlign:{type:String,default:function(){return _conf.default.headerAlign}},footerAlign:{type:String,default:function(){return _conf.default.footerAlign}},showHeader:{type:Boolean,default:function(){return _conf.default.showHeader}},startIndex:{type:Number,default:0},highlightCurrentRow:{type:Boolean,default:function(){return _conf.default.highlightCurrentRow}},highlightHoverRow:{type:Boolean,default:function(){return _conf.default.highlightHoverRow}},highlightCurrentColumn:{type:Boolean,default:function(){return _conf.default.highlightCurrentColumn}},highlightHoverColumn:{type:Boolean,default:function(){return _conf.default.highlightHoverColumn}},highlightCell:Boolean,showFooter:Boolean,footerMethod:Function,rowClassName:[String,Function],cellClassName:[String,Function],headerRowClassName:[String,Function],headerCellClassName:[String,Function],footerRowClassName:[String,Function],footerCellClassName:[String,Function],spanMethod:Function,showOverflow:{type:[Boolean,String],default:function(){return _conf.default.showOverflow}},showHeaderOverflow:{type:[Boolean,String],default:function(){return _conf.default.showHeaderOverflow}},remoteFilter:Boolean,remoteSort:Boolean,sortMethod:Function,columnWidth:[Number,String],columnMinWidth:[Number,String],columnKey:Boolean,rowKey:Boolean,rowId:{type:String,default:function(){return _conf.default.rowId}},autoResize:Boolean,syncResize:Boolean,sortConfig:Object,radioConfig:Object,selectConfig:Object,tooltipConfig:Object,expandConfig:Object,treeConfig:Object,contextMenu:Object,mouseConfig:Object,keyboardConfig:Object,editConfig:Object,validConfig:Object,editRules:Object,optimization:Object,params:Object},provide:function(){return{$table:this}},inject:{$grid:{default:null}},data:function(){return{id:_xeUtils.default.uniqueId(),collectColumn:[],tableFullColumn:[],tableColumn:[],tableData:[],scrollXLoad:!1,scrollYLoad:!1,overflowY:!0,overflowX:!1,scrollbarWidth:0,scrollbarHeight:0,isAllSelected:!1,isIndeterminate:!1,selection:[],currentRow:null,selectRow:null,footerData:[],expandeds:[],treeExpandeds:[],treeIndeterminates:[],filterStore:{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1},columnStore:{leftList:[],centerList:[],rightList:[],resizeList:[],pxList:[],pxMinList:[],scaleList:[],scaleMinList:[],autoList:[]},ctxMenuStore:{selected:null,visible:!1,showChild:!1,selectChild:null,list:[],style:null},editStore:{indexs:{columns:[]},titles:{columns:[]},checked:{rows:[],columns:[],tRows:[],tColumns:[]},selected:{row:null,column:null},copyed:{cut:!1,rows:[],columns:[]},actived:{row:null,column:null},insertList:[],removeList:[]},validStore:{visible:!1,row:null,column:null,content:"",rule:null,isArrow:!1}}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},validOpts:function(){return Object.assign({message:"default"},_conf.default.validConfig,this.validConfig)},optimizeOpts:function(){return Object.assign({},_conf.default.optimization,this.optimization)},vaildTipOpts:function(){return Object.assign({isArrow:!1},this.tooltipConfig)},sortOpts:function(){return Object.assign({},_conf.default.sortConfig,this.sortConfig)},isGroup:function(){return this.collectColumn.some(function(e){return _tools.UtilTools.hasChildrenList(e)})},hasTip:function(){return _tableCore.default._tooltip},visibleColumn:function(){return this.tableFullColumn?this.tableFullColumn.filter(function(e){return e.visible}):[]},isResizable:function(){return this.resizable||this.tableFullColumn.some(function(e){return e.resizable})},hasFilter:function(){return this.tableColumn.some(function(e){return e.filters&&e.filters.length})},headerCtxMenu:function(){return this.ctxMenuOpts.header&&this.ctxMenuOpts.header.options?this.ctxMenuOpts.header.options:[]},bodyCtxMenu:function(){return this.ctxMenuOpts.body&&this.ctxMenuOpts.body.options?this.ctxMenuOpts.body.options:[]},isCtxMenu:function(){return this.headerCtxMenu.length||this.bodyCtxMenu.length},ctxMenuOpts:function(){return Object.assign({},_conf.default.menu,this.contextMenu)},_loadingConfig:function(){return Object.assign({},_conf.default.loadingConfig,this.loadingConfig)},ctxMenuList:function(){var t=[];return this.ctxMenuStore.list.forEach(function(e){e.forEach(function(e){t.push(e)})}),t}},watch:{data:function(e){this._isUpdateData||this.loadTableData(e,!0).then(this.handleDefault),this._isUpdateData=!1},customs:function(e){this.isUpdateCustoms||this.mergeCustomColumn(e),this.isUpdateCustoms=!1},collectColumn:function(e){var t=_tools.UtilTools.getColumnList(e);if(this.tableFullColumn=t,this.cacheColumnMap(),this.customs&&this.mergeCustomColumn(this.customs),this.refreshColumn(),this.handleTableData(!0),this.$toolbar&&this.$toolbar.updateColumn(t),t.length){var o=Math.floor((t.length-1)/2);t[o].prop&&_tools.UtilTools.warn("s.error.delProp"),t[o].label&&_tools.UtilTools.warn("s.error.delLabel")}this.treeConfig&&t.some(function(e){return e.fixed})&&t.some(function(e){return"expand"===e.type})&&_tools.UtilTools.warn("s.error.treeFixedExpand")},tableColumn:function(){this.analyColumnWidth()},height:function(){this.$nextTick(this.recalculate)},loading:function(){this._isLoading||(this._isLoading=!0)},syncResize:function(e){e&&this.$nextTick(this.recalculate)}},created:function(){var e=this,t=Object.assign(this,{elemStore:{},scrollXStore:{},scrollYStore:{},tooltipStore:{},parentHeight:0,tableWidth:0,tableHeight:0,headerHeight:0,footerHeight:0,lastScrollLeft:0,lastScrollTop:0,tableFullData:[],afterFullData:[],fullAllDataRowMap:new Map,fullAllDataRowIdData:{},fullDataRowMap:new Map,fullDataRowIdData:{},fullColumnMap:new Map,fullColumnIdData:{}}),o=t.scrollYStore,l=t.optimizeOpts,i=t.data,n=t.loading,r=l.scrollY;if(this._isLoading=n,_tools.UtilTools.getRowkey(this)||_tools.UtilTools.error("s.error.rowIdEmpty"),!_tableCore.default._keyboard&&(this.keyboardConfig||this.mouseConfig))throw new Error(_tools.UtilTools.error("s.error.reqKeyboard"));if(!_tableCore.default._resize&&this.autoResize)throw new Error(_tools.UtilTools.error("s.error.reqResize"));r&&Object.assign(o,{startIndex:0,visibleIndex:0,adaptive:!_xeUtils.default.isBoolean(r.adaptive)||r.adaptive,renderSize:_xeUtils.default.toNumber(r.rSize),offsetSize:_xeUtils.default.toNumber(r.oSize)}),this.loadTableData(i,!0).then(function(){e.handleDefault(),e.updateStyle()}),_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent),_tools.GlobalEvent.on(this,"blur",this.handleGlobalBlurEvent),_tools.GlobalEvent.on(this,"mousewheel",this.handleGlobalMousewheelEvent),_tools.GlobalEvent.on(this,"keydown",this.handleGlobalKeydownEvent),_tools.GlobalEvent.on(this,"resize",this.handleGlobalResizeEvent),_tools.GlobalEvent.on(this,"contextmenu",this.handleGlobalContextmenuEvent)},mounted:function(){this.autoResize&&_tableCore.default._resize&&this.bindResize(),0<_tools.DomTools.getParents(this.$el,".s-table-complete-outline").length?_tools.DomTools.getParents(this.$el,".s-table-complete-outline")[0].children[0].appendChild(this.$refs.tableWrapper):document.body.appendChild(this.$refs.tableWrapper)},activated:function(){var e=this,t=this.lastScrollLeft,o=this.lastScrollTop;(t||o)&&this.clearScroll().then(this.recalculate).then(function(){return e.scrollTo(t,o)})},beforeDestroy:function(){var e=this.$refs.tableWrapper;e&&e.parentNode&&e.parentNode.removeChild(e),_tableCore.default._resize&&this.unbindResize(),this.closeFilter(),this.closeMenu()},destroyed:function(){_tools.GlobalEvent.off(this,"mousedown"),_tools.GlobalEvent.off(this,"blur"),_tools.GlobalEvent.off(this,"mousewheel"),_tools.GlobalEvent.off(this,"keydown"),_tools.GlobalEvent.off(this,"resize"),_tools.GlobalEvent.off(this,"contextmenu")},render:function(e){var t,o=this._e,l=this.id,i=this.tableData,n=this.tableColumn,r=this.visibleColumn,s=this.collectColumn,a=this.isGroup,u=this.hasFilter,f=this.isResizable,d=this.isCtxMenu,h=this.loading,c=this._loadingConfig,p=this._isLoading,b=this.showHeader,m=this.border,g=this.stripe,C=this.height,_=this.highlightHoverRow,v=this.highlightHoverColumn,w=this.highlightCell,y=this.vSize,x=this.showOverflow,S=this.showHeaderOverflow,z=this.editConfig,O=this.validOpts,M=this.mouseConfig,D=void 0===M?{}:M,R=this.editRules,F=this.showFooter,T=this.footerMethod,j=this.overflowX,L=this.overflowY,B=this.scrollbarHeight,E=this.optimizeOpts,G=this.vaildTipOpts,P=this.tooltipConfig,H=this.columnStore,U=this.filterStore,N=this.ctxMenuStore,$=this.footerData,q=this.hasTip,I=H.leftList,k=H.rightList;return e("div",{class:(t={"s-table":1},_defineProperty(t,"size--".concat(y),y),_defineProperty(t,"s-editable",z),_defineProperty(t,"show--head",b),_defineProperty(t,"show--foot",F),_defineProperty(t,"scroll--y",L),_defineProperty(t,"scroll--x",j),_defineProperty(t,"fixed--left",I.length),_defineProperty(t,"fixed--right",k.length),_defineProperty(t,"all-overflow",x),_defineProperty(t,"all-head-overflow",S),_defineProperty(t,"c--highlight",w),_defineProperty(t,"t--animat",E.animat),_defineProperty(t,"t--stripe",g),_defineProperty(t,"t--border",m),_defineProperty(t,"t--checked",D.checked),_defineProperty(t,"is--loading",h),_defineProperty(t,"row--highlight",_),_defineProperty(t,"column--highlight",v),t)},[e("div",{class:"s-table-hidden-column",ref:"hideColumn"},this.$slots.default),b?e("s-table-header",{ref:"tableHeader",props:{tableData:i,tableColumn:n,visibleColumn:r,collectColumn:s,size:y,isGroup:a}}):o(),e("s-table-body",{ref:"tableBody",props:{tableData:i,tableColumn:n,visibleColumn:r,collectColumn:s,size:y,isGroup:a}}),F?e("s-table-footer",{props:{footerData:$,footerMethod:T,tableColumn:n,visibleColumn:r,size:y},ref:"tableFooter"}):o(),I&&I.length&&j?renderFixed(e,this,"left"):o(),k&&k.length&&j?renderFixed(e,this,"right"):o(),f?e("div",{class:"s-table--resizable-bar",style:j?{"padding-bottom":"".concat(B,"px")}:null,ref:"resizeBar"}):o(),p?e("s-table-loading",{props:Object.assign({visible:h},c)}):o(),e("div",{class:"s-table".concat(l,"-wrapper ").concat(this.$vnode.data.staticClass||""),ref:"tableWrapper"},[u?e("s-table-filter",{props:{optimizeOpts:E,filterStore:U},ref:"filterWrapper"}):o(),d?e("s-table-context-menu",{props:{ctxMenuStore:N},ref:"ctxWrapper"}):o(),e("div",{class:"s-table--complete-wrapper",ref:"s-table-complete"},[e("div",{class:"s-table--complete"},[e("div",{class:"s-table--complete-main"}),e("i",{class:"s-icon--close",on:{click:function(e){e.currentTarget.parentNode.parentNode.style.display="none"}}})])]),q?e("s-tooltip",{ref:"tooltip",props:P}):o(),q&&R&&("default"===O.message?!C:"tooltip"===O.message)?e("s-tooltip",{class:"s-table--valid-error",props:"tooltip"===O.message||1===i.length?G:null,ref:"validTip"}):o()])])},methods:_methods.default};exports.default=_default2;
"use strict";Object.defineProperty(exports,"__esModule",{value:!0}),exports.default=void 0;var _xeUtils=_interopRequireDefault(require("xe-utils")),_conf=_interopRequireDefault(require("../../conf")),_cell=_interopRequireDefault(require("../../cell")),_tableCore=require("../../table-core"),_tools=require("../../tools");function _interopRequireDefault(e){return e&&e.__esModule?e:{default:e}}function _defineProperty(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _defineProperties(e,t){for(var o=0;o<t.length;o++){var l=t[o];l.enumerable=l.enumerable||!1,l.configurable=!0,"value"in l&&(l.writable=!0),Object.defineProperty(e,l.key,l)}}function _createClass(e,t,o){return t&&_defineProperties(e.prototype,t),o&&_defineProperties(e,o),e}var rowUniqueId=0,browse=_tools.DomTools.browse,isWebkit=browse["-webkit"]&&!browse.edge,debounceScrollYDuration=browse.msie?40:20,Rule=function(){function t(e){_classCallCheck(this,t),Object.assign(this,{$options:e,required:e.required,min:e.min,max:e.min,type:e.type,pattern:e.pattern,validator:e.validator,trigger:e.trigger,maxWidth:e.maxWidth})}return _createClass(t,[{key:"message",get:function(){return _tools.UtilTools.getFuncText(this.$options.message)}}]),t}();function getRowUniqueId(){return"row_".concat(++rowUniqueId)}function renderFixed(e,t,o){var l=t.tableData,i=t.tableColumn,n=t.visibleColumn,r=t.collectColumn,s=t.isGroup,a=t.vSize,c=t.showHeader,u=t.showFooter,h=t.columnStore,d=t.footerData,f=h["".concat(o,"List")];return e("div",{class:"s-table--fixed-".concat(o,"-wrapper"),ref:"".concat(o,"Container")},[c?e("s-table-header",{props:{fixedType:o,tableData:l,tableColumn:i,visibleColumn:n,collectColumn:r,size:a,fixedColumn:f,isGroup:s},ref:"".concat(o,"Header")}):null,e("s-table-body",{props:{fixedType:o,tableData:l,tableColumn:i,visibleColumn:n,collectColumn:r,fixedColumn:f,size:a,isGroup:s},ref:"".concat(o,"Body")}),u?e("s-table-footer",{props:{fixedType:o,footerData:d,tableColumn:i,visibleColumn:n,size:a,fixedColumn:f},ref:"".concat(o,"Footer")}):null])}var headerProps={children:"children"},_default2={name:"STable",props:{data:Array,customs:Array,height:[Number,String],maxHeight:[Number,String],resizable:{type:Boolean,default:function(){return _conf.default.resizable}},stripe:{type:Boolean,default:function(){return _conf.default.stripe}},border:{type:Boolean,default:function(){return _conf.default.border}},size:{type:String,default:function(){return _conf.default.size}},fit:{type:Boolean,default:function(){return _conf.default.fit}},loading:Boolean,loadingConfig:Object,align:{type:String,default:function(){return _conf.default.align}},headerAlign:{type:String,default:function(){return _conf.default.headerAlign}},showHeader:{type:Boolean,default:function(){return _conf.default.showHeader}},startIndex:{type:Number,default:0},highlightCurrentRow:{type:Boolean,default:function(){return _conf.default.highlightCurrentRow}},highlightHoverRow:{type:Boolean,default:function(){return _conf.default.highlightHoverRow}},highlightCurrentColumn:{type:Boolean,default:function(){return _conf.default.highlightCurrentColumn}},highlightHoverColumn:{type:Boolean,default:function(){return _conf.default.highlightHoverColumn}},highlightCell:Boolean,showFooter:Boolean,footerMethod:Function,rowClassName:[String,Function],cellClassName:[String,Function],headerRowClassName:[String,Function],headerCellClassName:[String,Function],footerRowClassName:[String,Function],footerCellClassName:[String,Function],spanMethod:Function,showOverflow:{type:[Boolean,String],default:function(){return _conf.default.showOverflow}},showHeaderOverflow:{type:[Boolean,String],default:function(){return _conf.default.showHeaderOverflow}},remoteFilter:Boolean,remoteSort:Boolean,columnWidth:[Number,String],columnMinWidth:[Number,String],columnKey:Boolean,rowKey:Boolean,rowId:{type:String,default:function(){return _conf.default.rowId}},autoResize:Boolean,sortConfig:Object,radioConfig:Object,selectConfig:Object,tooltipConfig:Object,expandConfig:Object,treeConfig:Object,contextMenu:Object,mouseConfig:Object,keyboardConfig:Object,editConfig:Object,validConfig:Object,editRules:Object,optimization:Object,params:Object},provide:function(){return{$table:this}},data:function(){return{id:_xeUtils.default.uniqueId(),collectColumn:[],tableFullColumn:[],tableColumn:[],tableData:[],scrollXLoad:!1,scrollYLoad:!1,overflowY:!0,overflowX:!1,scrollbarWidth:0,scrollbarHeight:0,isAllSelected:!1,isIndeterminate:!1,selection:[],currentRow:null,selectRow:null,footerData:[],expandeds:[],treeExpandeds:[],treeIndeterminates:[],filterStore:{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1},columnStore:{leftList:[],centerList:[],rightList:[],resizeList:[],pxList:[],pxMinList:[],scaleList:[],scaleMinList:[],autoList:[]},ctxMenuStore:{selected:null,visible:!1,showChild:!1,selectChild:null,list:[],style:null},editStore:{indexs:{columns:[]},titles:{columns:[]},checked:{rows:[],columns:[],tRows:[],tColumns:[]},selected:{row:null,column:null},copyed:{cut:!1,rows:[],columns:[]},actived:{row:null,column:null},insertList:[],removeList:[]},validStore:{visible:!1,row:null,column:null,content:"",rule:null,isArrow:!1}}},computed:{vSize:function(){return this.size||this.$parent.size||this.$parent.vSize},validOpts:function(){return Object.assign({message:"default"},_conf.default.validConfig,this.validConfig)},optimizeOpts:function(){return Object.assign({},_conf.default.optimization,this.optimization)},vaildTipOpts:function(){return Object.assign({isArrow:!1},this.tooltipConfig)},sortOpts:function(){return Object.assign({},_conf.default.sortConfig,this.sortConfig)},isGroup:function(){return this.collectColumn.some(function(e){return _tools.UtilTools.hasChildrenList(e)})},hasTip:function(){return _conf.default._tip},visibleColumn:function(){return this.tableFullColumn?this.tableFullColumn.filter(function(e){return e.visible}):[]},isResizable:function(){return this.resizable||this.tableFullColumn.some(function(e){return e.resizable})},hasFilter:function(){return this.tableColumn.some(function(e){return e.filters&&e.filters.length})},headerCtxMenu:function(){return this.ctxMenuOpts.header&&this.ctxMenuOpts.header.options?this.ctxMenuOpts.header.options:[]},bodyCtxMenu:function(){return this.ctxMenuOpts.body&&this.ctxMenuOpts.body.options?this.ctxMenuOpts.body.options:[]},isCtxMenu:function(){return this.headerCtxMenu.length||this.bodyCtxMenu.length},ctxMenuOpts:function(){return Object.assign({},_conf.default.menu,this.contextMenu)},_loadingConfig:function(){return Object.assign({},_conf.default.loadingConfig,this.loadingConfig)},ctxMenuList:function(){var t=[];return this.ctxMenuStore.list.forEach(function(e){e.forEach(function(e){t.push(e)})}),t}},watch:{data:function(e){this._isUpdateData||this.loadData(e,!0).then(this.handleDefault),this._isUpdateData=!1},customs:function(e){this.isUpdateCustoms||this.mergeCustomColumn(e),this.isUpdateCustoms=!1},collectColumn:function(e){var t=_tools.UtilTools.getColumnList(e);if(this.tableFullColumn=t,this.cacheColumnMap(),this.customs&&this.mergeCustomColumn(this.customs),this.refreshColumn(),this.handleData(!0),this._toolbar&&this._toolbar.updateColumn(t),t.length){var o=Math.floor((t.length-1)/2);t[o].prop&&_tools.UtilTools.warn("s.error.delProp"),t[o].label&&_tools.UtilTools.warn("s.error.delLabel")}},tableColumn:function(){this.analyColumnWidth()},height:function(){this.$nextTick(this.recalculate)},loading:function(){this._isLoading||(this._isLoading=!0)}},created:function(){var e=this,t=Object.assign(this,{elemStore:{},scrollXStore:{},scrollYStore:{},tooltipStore:{},parentHeight:0,tableWidth:0,tableHeight:0,headerHeight:0,footerHeight:0,lastScrollLeft:0,lastScrollTop:0,tableFullData:[],afterFullData:[],fullAllDataRowMap:new Map,fullAllDataRowIdData:{},fullDataRowMap:new Map,fullDataRowIdData:{},fullColumnMap:new Map,fullColumnIdData:{}}),o=t.scrollYStore,l=t.optimizeOpts,i=t.data,n=t.loading,r=l.scrollY;this._isLoading=n,r&&Object.assign(o,{startIndex:0,visibleIndex:0,adaptive:!_xeUtils.default.isBoolean(r.adaptive)||r.adaptive,renderSize:_xeUtils.default.toNumber(r.rSize),offsetSize:_xeUtils.default.toNumber(r.oSize)}),_tools.UtilTools.getRowkey(this)||_tools.UtilTools.error("s.error.rowIdEmpty"),this.loadData(i,!0).then(function(){e.handleDefault(),e.updateStyle()}),_tools.GlobalEvent.on(this,"mousedown",this.handleGlobalMousedownEvent),_tools.GlobalEvent.on(this,"blur",this.handleGlobalBlurEvent),_tools.GlobalEvent.on(this,"contextmenu",this.handleGlobalContextmenuEvent),_tools.GlobalEvent.on(this,"mousewheel",this.handleGlobalMousewheelEvent),_tools.GlobalEvent.on(this,"keydown",this.handleGlobalKeydownEvent),_tools.GlobalEvent.on(this,"resize",this.handleGlobalResizeEvent)},mounted:function(){this.autoResize&&_tools.ResizeEvent.on(this,this.$el.parentNode,this.recalculate),0<_tools.DomTools.getParents(this.$el,".s-table-complete-outline").length?_tools.DomTools.getParents(this.$el,".s-table-complete-outline")[0].children[0].appendChild(this.$refs.tableWrapper):document.body.appendChild(this.$refs.tableWrapper)},activated:function(){this.scrollTo(this.lastScrollLeft,this.lastScrollTop)},beforeDestroy:function(){var e=this.$refs.tableWrapper;e&&e.parentNode&&e.parentNode.removeChild(e),_tools.ResizeEvent.off&&_tools.ResizeEvent.off(this,this.$el.parentNode),this.closeFilter(),this.closeMenu()},destroyed:function(){_tools.GlobalEvent.off(this,"mousedown"),_tools.GlobalEvent.off(this,"blur"),_tools.GlobalEvent.off(this,"contextmenu"),_tools.GlobalEvent.off(this,"mousewheel"),_tools.GlobalEvent.off(this,"keydown"),_tools.GlobalEvent.off(this,"resize")},render:function(e){var t,o=this._e,l=this.id,i=this.tableData,n=this.tableColumn,r=this.visibleColumn,s=this.collectColumn,a=this.isGroup,c=this.hasFilter,u=this.isResizable,h=this.isCtxMenu,d=this.loading,f=this._loadingConfig,g=this._isLoading,m=this.showHeader,p=this.border,v=this.stripe,x=this.height,b=this.highlightHoverRow,C=this.highlightHoverColumn,w=this.highlightCell,_=this.vSize,T=this.showOverflow,y=this.showHeaderOverflow,S=this.editConfig,D=this.validOpts,R=this.mouseConfig,E=void 0===R?{}:R,k=this.editRules,U=this.showFooter,I=this.footerMethod,$=this.overflowX,O=this.overflowY,M=this.scrollbarHeight,N=this.optimizeOpts,F=this.vaildTipOpts,L=this.tooltipConfig,A=this.columnStore,z=this.filterStore,H=this.ctxMenuStore,W=this.footerData,P=this.hasTip,j=A.leftList,B=A.rightList;return e("div",{class:(t={"s-table":1},_defineProperty(t,"size--".concat(_),_),_defineProperty(t,"s-editable",S),_defineProperty(t,"show--head",m),_defineProperty(t,"show--foot",U),_defineProperty(t,"scroll--y",O),_defineProperty(t,"scroll--x",$),_defineProperty(t,"fixed--left",j.length),_defineProperty(t,"fixed--right",B.length),_defineProperty(t,"all-overflow",T),_defineProperty(t,"all-head-overflow",y),_defineProperty(t,"c--highlight",w),_defineProperty(t,"t--animat",N.animat),_defineProperty(t,"t--stripe",v),_defineProperty(t,"t--border",p),_defineProperty(t,"t--checked",E.checked),_defineProperty(t,"is--loading",d),_defineProperty(t,"row--highlight",b),_defineProperty(t,"column--highlight",C),t)},[e("div",{class:"s-table-hidden-column",ref:"hideColumn"},this.$slots.default),m?e("s-table-header",{ref:"tableHeader",props:{tableData:i,tableColumn:n,visibleColumn:r,collectColumn:s,size:_,isGroup:a}}):o(),e("s-table-body",{ref:"tableBody",props:{tableData:i,tableColumn:n,visibleColumn:r,collectColumn:s,size:_,isGroup:a}}),U?e("s-table-footer",{props:{footerData:W,footerMethod:I,tableColumn:n,visibleColumn:r,size:_},ref:"tableFooter"}):o(),j&&j.length&&$?renderFixed(e,this,"left"):o(),B&&B.length&&$?renderFixed(e,this,"right"):o(),u?e("div",{class:"s-table--resizable-bar",style:$?{"padding-bottom":"".concat(M,"px")}:null,ref:"resizeBar"}):o(),g?e("s-table-loading",{props:Object.assign({visible:d},f)}):o(),e("div",{class:"s-table".concat(l,"-wrapper ").concat(this.$vnode.data.staticClass||""),ref:"tableWrapper"},[c?e("s-table-filter",{props:{optimizeOpts:N,filterStore:z},ref:"filterWrapper"}):o(),h?e("s-table-context-menu",{props:{ctxMenuStore:H},ref:"ctxWrapper"}):o(),e("div",{class:"s-table--complete-wrapper",ref:"s-table-complete"},[e("div",{class:"s-table--complete"},[e("div",{class:"s-table--complete-main"}),e("i",{class:"s-icon--close",on:{click:function(e){e.currentTarget.parentNode.parentNode.style.display="none"}}})])]),P?e("s-tooltip",{ref:"tooltip",props:L}):o(),P&&k&&("default"===D.message?!x:"tooltip"===D.message)?e("s-tooltip",{class:"s-table--valid-error",props:"tooltip"===D.message||1===i.length?F:null,ref:"validTip"}):o()])])},methods:{clearAll:function(){return this.clearScroll(),this.clearSort(),this.clearFilter(),this.clearCurrentRow(),this.clearCurrentColumn(),this.clearSelection(),this.clearRowExpand(),this.clearTreeExpand(),this.clearIndexChecked(),this.clearHeaderChecked(),this.clearChecked(),this.clearSelected(),this.clearCopyed(),this.clearActived()},refreshData:function(){var e=this;return this.$nextTick().then(function(){return e.tableData=[],e.$nextTick().then(function(){return e.loadData(e.tableFullData)})})},updateData:function(){return this.handleData(!0).then(this.recalculate)},handleData:function(e){return this.tableData=this.getTableData(e).tableData,this.$nextTick()},loadData:function(e,t){var o=this,l=this.height,i=this.maxHeight,n=this.editStore,r=this.optimizeOpts,s=this.recalculate,a=r.scrollY,c=e?e.slice(0):[],u=a&&a.gt&&a.gt<c.length;n.insertList=[],n.removeList=[],this.tableFullData=c,this.updateCache(!0),this.tableSynchData=e,this.tableSourceData=_xeUtils.default.clone(c,!0),!(this.scrollYLoad=u)||l||i||_tools.UtilTools.error("s.error.scrollYHeight"),this.handleData(!0),this.reserveCheckSelection(),this.checkSelectionStatus();var h=this.$nextTick();return t||(h=h.then(s)),h.then(function(){(o.scrollXLoad||o.scrollYLoad)&&o.clearScroll()})},reloadData:function(e){return this.clearAll(),this.loadData(e).then(this.handleDefault)},loadColumn:function(e){var t=this;return this.collectColumn=_xeUtils.default.mapTree(e,function(e){return _cell.default.createColumn(t,e)},headerProps),this.$nextTick()},reloadColumn:function(e){return this.clearAll(),this.loadColumn(e)},updateCache:function(i){var n=this,e=this.treeConfig,t=this.tableFullData,r=this.fullDataRowIdData,s=this.fullDataRowMap,a=this.fullAllDataRowMap,c=this.fullAllDataRowIdData,u=_tools.UtilTools.getRowkey(this),o=function(e,t){var o=_tools.UtilTools.getRowid(n,e);o||(o=getRowUniqueId(),_xeUtils.default.set(e,u,o));var l={row:e,rowid:o,index:t};i&&(r[o]=l,s.set(e,l)),c[o]=l,a.set(e,l)};i&&(r=this.fullDataRowIdData={},s.clear()),c=this.fullAllDataRowIdData={},a.clear(),e?_xeUtils.default.eachTree(t,o,e):t.forEach(o)},cacheColumnMap:function(){var e=this.tableFullColumn,l=this.fullColumnMap,i=this.fullColumnIdData={};l.clear(),e.forEach(function(e,t){var o={column:e,colid:e.id,index:t};i[e.id]=o,l.set(e,o)})},getRowNode:function(e){var t=this;if(e){var o=this.treeConfig,l=this.tableFullData,i=this.fullAllDataRowIdData,n=e.getAttribute("data-rowid");if(o){var r=_xeUtils.default.findTree(l,function(e){return _tools.UtilTools.getRowid(t,e)===n},o);if(r)return r}else if(i[n]){var s=i[n];return{item:s.row,index:s.index,items:l}}}return null},getColumnNode:function(e){if(e){var t=this.isGroup,o=this.fullColumnIdData,l=this.tableFullColumn,i=e.getAttribute("data-colid");if(!t){var n=o[i];return{item:n.column,index:n.index,items:l}}var r=_xeUtils.default.findTree(l,function(e){return e.id===i},headerProps);if(r)return r}return null},getRowIndex:function(e){return this.fullDataRowMap.has(e)?this.fullDataRowMap.get(e).index:-1},getColumnIndex:function(e){return this.fullColumnMap.has(e)?this.fullColumnMap.get(e).index:-1},hasIndexColumn:function(e){return e&&"index"===e.type},insert:function(e){return this.insertAt(e)},insertAt:function(e,t){var o=this,l=this.afterFullData,i=this.tableData,n=this.editStore,r=this.scrollYLoad,s=this.tableFullData;if(this.treeConfig)throw new Error(_tools.UtilTools.error("s.error.treeInsert"));_xeUtils.default.isArray(e)||(e=[e]);var a=r?l:i,c=e.map(function(e){return o.defineField(Object.assign({},e))});if(t)if(-1===t)a.push.apply(a,c),s.push.apply(s,c);else{var u=a.indexOf(t);if(-1===u)throw new Error("[s-table] Unable to insert to the specified location.");a.splice.apply(a,[u,0].concat(c)),s.splice.apply(s,[s.indexOf(t),0].concat(c))}else a.unshift.apply(a,c),s.unshift.apply(s,c);return[].unshift.apply(n.insertList,c),r&&this.updateScrollYSpace(),this.updateCache(),this.checkSelectionStatus(),this.$nextTick().then(function(){return o.recalculate(),{row:c.length?c[c.length-1]:null,rows:c}})},defineField:function(t){var e=_tools.UtilTools.getRowkey(this);return this.visibleColumn.forEach(function(e){e.property&&!_xeUtils.default.has(t,e.property)&&_xeUtils.default.set(t,e.property,null)}),_xeUtils.default.get(t,e)||_xeUtils.default.set(t,e,getRowUniqueId()),t},createData:function(e){var t=this;return this.$nextTick().then(function(){return e.map(t.defineField)})},createRow:function(t){var o=this,l=_xeUtils.default.isArray(t);return l||(t=[t]),this.$nextTick().then(function(){var e=t.map(function(e){return o.defineField(Object.assign({},e))});return l?e:e[0]})},remove:function(r){var e=this,t=this.tableData,s=this.tableFullData,o=this.editStore,a=this.treeConfig,l=this.selectConfig,i=void 0===l?{}:l,c=this.selection,u=this.hasRowInsert,n=this.scrollYLoad,h=o.removeList,d=o.insertList,f=i.checkField,g=[];return r&&(_xeUtils.default.isArray(r)||(r=[r]),a?r.forEach(function(t){var e=_xeUtils.default.findTree(s,function(e){return e===t},a);if(e){var o=e.item,l=e.items,i=e.index;u(o)||h.push(o);var n=l.splice(i,1)[0];f||_xeUtils.default.remove(c,function(e){return-1<r.indexOf(e)}),g.push(n)}}):(r.forEach(function(e){u(e)||h.push(e)}),g=_xeUtils.default.remove(s,function(e){return-1<r.indexOf(e)}),f||_xeUtils.default.remove(c,function(e){return-1<r.indexOf(e)}),_xeUtils.default.remove(t,function(e){return-1<r.indexOf(e)})),_xeUtils.default.remove(d,function(e){return-1<r.indexOf(e)})),n&&this.updateScrollYSpace(),this.updateCache(),this.checkSelectionStatus(),this.$nextTick().then(function(){return e.recalculate(),{row:r&&r.length?r[r.length-1]:null,rows:g}})},removeSelecteds:function(){var t=this;return this.remove(this.getSelectRecords()).then(function(e){return t.clearSelection(),e})},revert:function(e,l){var i=this.tableSourceData,n=this.getRowIndex;return arguments.length?(e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){var t=n(e),o=i[t];o&&e&&(l?_xeUtils.default.set(e,l,_xeUtils.default.get(o,l)):_xeUtils.default.destructuring(e,o))}),this.$nextTick()):this.reloadData(i)},clearData:function(e,t){var o=this.tableFullData,l=this.visibleColumn;return arguments.length?e&&!_xeUtils.default.isArray(e)&&(e=[e]):e=o,t?e.forEach(function(e){return _xeUtils.default.set(e,t,null)}):e.forEach(function(t){l.forEach(function(e){e.property&&_tools.UtilTools.setCellValue(t,e,null)})}),this.$nextTick()},hasRowInsert:function(e){return-1<this.editStore.insertList.indexOf(e)},hasRowChange:function(e,t){var o,l,i=this,n=this.visibleColumn,r=this.treeConfig,s=this.tableSourceData,a=this.fullDataRowIdData,c=_tools.UtilTools.getRowid(this,e);if(!a[c])return!1;if(r){var u=r.children,h=_xeUtils.default.findTree(s,function(e){return c===_tools.UtilTools.getRowid(i,e)},r);e=Object.assign({},e,_defineProperty({},u,null)),h&&(o=Object.assign({},h.item,_defineProperty({},u,null)))}else{o=s[a[c].index]}if(o){if(1<arguments.length)return!_xeUtils.default.isEqual(_xeUtils.default.get(o,t),_xeUtils.default.get(e,t));for(var d=0,f=n.length;d<f;d++)if((l=n[d].property)&&!_xeUtils.default.isEqual(_xeUtils.default.get(o,l),_xeUtils.default.get(e,l)))return!0}return!1},getColumns:function(e){var t=this.visibleColumn;return arguments.length?t[e]:t.slice(0)},getColumnById:function(e){var t=this.fullColumnIdData;return t[e]?t[e].column:null},getColumnByField:function(t){return this.visibleColumn.find(function(e){return e.property===t})},getTableColumn:function(){return{fullColumn:this.tableFullColumn.slice(0),visibleColumn:this.visibleColumn.slice(0),tableColumn:this.tableColumn.slice(0)}},getRecords:function(){return _tools.UtilTools.warn("s.error.delGetRecords"),this.getData.apply(this,arguments)},getData:function(e){var t=this.data||this.tableSynchData;return arguments.length?t[e]:t.slice(0)},getAllRecords:function(){return _tools.UtilTools.warn("s.error.delGetAllRecords"),this.getRecordset()},getRecordset:function(){return{insertRecords:this.getInsertRecords(),removeRecords:this.getRemoveRecords(),updateRecords:this.getUpdateRecords()}},getInsertRecords:function(){return this.editStore.insertList},getRemoveRecords:function(){return this.editStore.removeList},getSelectRecords:function(){var e=this.tableFullData,t=this.editStore,o=this.treeConfig,l=this.selectConfig,i=(void 0===l?{}:l).checkField,n=[],r=[];if(i)n=o?_xeUtils.default.filterTree(e,function(e){return _xeUtils.default.get(e,i)},o):e.filter(function(e){return _xeUtils.default.get(e,i)}),r=t.insertList.filter(function(e){return _xeUtils.default.get(e,i)});else{var s=this.selection;n=o?_xeUtils.default.filterTree(e,function(e){return-1<s.indexOf(e)},o):e.filter(function(e){return-1<s.indexOf(e)}),r=t.insertList.filter(function(e){return-1<s.indexOf(e)})}return n.concat(r)},getUpdateRecords:function(){var e=this.tableFullData,t=this.hasRowChange,o=this.treeConfig;return o?_xeUtils.default.filterTree(e,function(e){return t(e)},o):e.filter(function(e){return t(e)})},updateAfterFullData:function(){var e=this.visibleColumn,t=this.tableFullData,o=this.remoteSort,c=this.remoteFilter,l=t,i=e.find(function(e){return e.order}),n=e.filter(function(e){var t=e.filters;return t&&t.length});if((l=l.filter(function(a){return n.every(function(t){var e=t.filters,o=t.filterRender,l=o?_tableCore.Renderer.get(o.name):null,i=[],n=[];if(e&&e.length&&(e.forEach(function(e){e.checked&&(n.push(e),i.push(e.value))}),i.length&&!c)){var r=t.property,s=t.filterMethod;return!s&&l&&l.renderFilter&&(s=l.filterMethod),s?n.some(function(e){return s({value:e.value,option:e,row:a,column:t})}):-1<i.indexOf(_xeUtils.default.get(a,r))}return!0})}),i&&i.order)&&!(_xeUtils.default.isBoolean(i.remoteSort)?i.remoteSort:o)){var r=_xeUtils.default.sortBy(l,i.property);l="desc"===i.order?r.reverse():r}return this.afterFullData=l},getRowById:function(e){var t=this.fullDataRowIdData;return t[e]?t[e].row:null},getTableData:function(e){var t=this.tableFullData,o=this.scrollYLoad,l=this.scrollYStore,i=e?this.updateAfterFullData():this.afterFullData;return{fullData:t.slice(0),visibleData:i.slice(0),tableData:o?i.slice(l.startIndex,l.startIndex+l.renderSize):i.slice(0)}},handleDefault:function(){this.selectConfig&&this.handleSelectionDefChecked(),this.radioConfig&&this.handleRadioDefChecked(),this.expandConfig&&this.handleDefaultRowExpand(),this.treeConfig&&this.handleDefaultTreeExpand(),this.updateFooter(),this.$nextTick(this.recalculate)},mergeCustomColumn:function(o){var e=this.tableFullColumn;this.isUpdateCustoms=!0,o.length&&e.forEach(function(t){var e=o.find(function(e){return t.property&&(e.field||e.prop)===t.property});e&&(_xeUtils.default.isNumber(e.resizeWidth)&&(t.resizeWidth=e.resizeWidth),_xeUtils.default.isBoolean(e.visible)&&(t.visible=e.visible))}),this.$emit("update:customs",e)},resetAll:function(){this.resetCustoms(),this.resetResizable()},hideColumn:function(e){return this.handleVisibleColumn(e,!1)},showColumn:function(e){return this.handleVisibleColumn(e,!0)},resetCustoms:function(){return this.handleVisibleColumn()},handleVisibleColumn:function(e,t){return arguments.length?e.visible=t:this.tableFullColumn.forEach(function(e){e.visible=!0}),this._toolbar&&this._toolbar.updateSetting(),this.$nextTick()},reloadCustoms:function(e){var t=this;return this.$nextTick().then(function(){return t.mergeCustomColumn(e),t.refreshColumn().then(function(){return t.tableFullColumn})})},refreshColumn:function(){var o,e=this,l=0,i=[],n=null,r=null,s=[],a=[],t=this.tableFullColumn,c=this.isGroup,u=this.columnStore,h=this.scrollXStore,d=this.optimizeOpts.scrollX;c&&_xeUtils.default.eachTree(this.collectColumn,function(e){e.children&&e.children.length&&(e.visible=!!_xeUtils.default.findTree(e.children,function(e){return e.children&&e.children.length?0:e.visible},headerProps))},headerProps),t.filter(function(e){return e.visible}).forEach(function(e,t){"left"===e.fixed?(null===n&&(n=l),o||(t-l!=0?o=!0:l++),i.push(e)):"right"===e.fixed?(o||(null===r&&(r=t),t-r!=0?o=!0:r++),a.push(e)):s.push(e)});var f=i.concat(s).concat(a),g=d&&d.gt&&d.gt<t.length;return Object.assign(u,{leftList:i,centerList:s,rightList:a}),c&&(o||n||null!==r&&r!==f.length)&&_tools.UtilTools.error("s.error.groupFixed"),g&&((this.resizable||f.some(function(e){return e.resizable}))&&_tools.UtilTools.warn("s.error.notResizable"),Object.assign(h,{startIndex:0,visibleIndex:0,renderSize:_xeUtils.default.toNumber(d.rSize),offsetSize:_xeUtils.default.toNumber(d.oSize)}),f=f.slice(h.startIndex,h.startIndex+h.renderSize)),this.scrollXLoad=g,this.tableColumn=f,this.$nextTick().then(function(){e.updateFooter(),e.recalculate(!0)})},analyColumnWidth:function(){var t=this.columnWidth,o=this.columnMinWidth,l=[],i=[],n=[],r=[],s=[],a=[];this.tableFullColumn.forEach(function(e){t&&!e.width&&(e.width=t),o&&!e.minWidth&&(e.minWidth=o),e.visible&&(e.resizeWidth?l.push(e):_tools.DomTools.isPx(e.width)?i.push(e):_tools.DomTools.isScale(e.width)?r.push(e):_tools.DomTools.isPx(e.minWidth)?n.push(e):_tools.DomTools.isScale(e.minWidth)?s.push(e):a.push(e))}),Object.assign(this.columnStore,{resizeList:l,pxList:i,pxMinList:n,scaleList:r,scaleMinList:s,autoList:a})},recalculate:function(e){var t=this,o=this.$refs,l=o.tableBody,i=o.tableHeader,n=o.tableFooter,r=l?l.$el:null,s=i?i.$el:null,a=n?n.$el:null;return r&&(this.autoCellWidth(s,r,a),!0===e)?this.computeScrollLoad().then(function(){t.autoCellWidth(s,r,a),t.computeScrollLoad()}):this.computeScrollLoad()},autoCellWidth:function(e,t,o){var i,n=0,r=t.clientWidth,l=r,s=this.$el,a=this.fit,c=this.columnStore,u=c.resizeList,h=c.pxMinList,d=c.pxList,f=c.scaleList,g=c.scaleMinList,m=c.autoList;h.forEach(function(e){var t=parseInt(e.minWidth);n+=t,e.renderWidth=t}),i=l/100,g.forEach(function(e){var t=Math.floor(parseInt(e.minWidth)*i);n+=t,e.renderWidth=t}),f.forEach(function(e){var t=Math.floor(parseInt(e.width)*i);n+=t,e.renderWidth=t}),d.forEach(function(e){var t=parseInt(e.width);n+=t,e.renderWidth=t}),u.forEach(function(e){var t=parseInt(e.resizeWidth);n+=t,e.renderWidth=t}),i=0<(l-=n)?Math.floor(l/(g.length+h.length+m.length)):0,a?0<l&&g.concat(h).forEach(function(e){n+=i,e.renderWidth+=i}):i=40,m.forEach(function(e,t){var o=Math.max(i,40);if(e.renderWidth=o,n+=o,a&&t===m.length-1){var l=r-n;0<l&&(e.renderWidth+=l,n=r)}});var p=t.offsetHeight,v=t.scrollHeight>t.clientHeight;if(this.scrollbarWidth=v?t.offsetWidth-r:0,this.overflowY=v,this.tableWidth=n,this.tableHeight=p,this.parentHeight=s.parentNode.clientHeight,e&&(this.headerHeight=e.offsetHeight),o){var x=o.offsetHeight;this.scrollbarHeight=Math.max(x-o.clientHeight,0),this.overflowX=n>o.clientWidth,this.footerHeight=x}else this.scrollbarHeight=Math.max(p-t.clientHeight,0),this.overflowX=r<n;this.overflowX&&this.checkScrolling()},resetResizable:function(){return this.visibleColumn.forEach(function(e){e.resizeWidth=0}),this._toolbar&&this._toolbar.resetResizable(),this.analyColumnWidth(),this.recalculate(!0)},updateStyle:function(){var t=this.$refs,p=this.fullColumnIdData,v=this.maxHeight,e=this.height,x=this.parentHeight,b=this.border,C=this.tableColumn,w=this.headerHeight,_=this.showHeaderOverflow,T=this.showFooter,y=this.showOverflow,S=this.footerHeight,D=this.tableHeight,R=this.tableWidth,E=this.overflowY,k=this.scrollbarHeight,U=this.scrollbarWidth,I=this.scrollXLoad,$=this.columnStore,O=this.elemStore,o=this.currentRow,M="auto"===e?x:_tools.DomTools.isScale(e)?Math.floor(parseInt(e)/100*x):_xeUtils.default.toNumber(e);return["main","left","right"].forEach(function(d,e){var f=0<e?d:"",g=$["".concat(f,"List")],m=t["".concat(f,"Container")];["header","body","footer"].forEach(function(c){var e=O["".concat(d,"-").concat(c,"-wrapper")],t=O["".concat(d,"-").concat(c,"-table")];if("header"===c){var o=R;I&&(f&&(C=g),o=C.reduce(function(e,t){return e+t.renderWidth},0)),t&&(t.style.width=null===o?o:"".concat(o+U,"px"));var l=O["".concat(d,"-").concat(c,"-repair")];l&&(l.style.width="".concat(R,"px"));var i=O["".concat(d,"-").concat(c,"-list")];i&&_xeUtils.default.arrayEach(i.querySelectorAll(".col--gutter"),function(e){e.style.width="".concat(U,"px")})}else if("body"===c){var n=O["".concat(d,"-").concat(c,"-emptyBlock")];if(e&&(0<M?e.style.height="".concat(f?(0<M?M-w-S:D)-(T?0:k):M-w-S,"px"):v&&(v=_tools.DomTools.isScale(v)?Math.floor(parseInt(v)/100*x):_xeUtils.default.toNumber(v),e.style.maxHeight="".concat(f?v-w-(T?0:k):v-w,"px"))),m){var r="right"===f,s=$["".concat(f,"List")];e.style.top="".concat(w,"px"),m.style.height="".concat((0<M?M-w-S:D)+w+S-k*(T?2:1),"px"),m.style.width="".concat(s.reduce(function(e,t){return e+t.renderWidth},r?U:0),"px")}var a=R;f&&y?a=(C=g).reduce(function(e,t){return e+t.renderWidth},0):I&&(f&&(C=g),a=C.reduce(function(e,t){return e+t.renderWidth},0)),t&&(t.style.width=a?"".concat(a,"px"):a,E&&f&&(browse["-moz"]||browse.safari)&&(t.style.paddingRight="".concat(U,"px"))),n&&(n.style.width=a?"".concat(a,"px"):a)}else if("footer"===c){var u=R;f&&y?u=(C=g).reduce(function(e,t){return e+t.renderWidth},0):I&&(f&&(C=g),u=C.reduce(function(e,t){return e+t.renderWidth},0)),e&&(m&&(e.style.top="".concat(M?M-S:D+w,"px")),e.style.marginTop="".concat(-k-1,"px")),t&&(t.style.width=null===u?u:"".concat(u+U,"px"))}var h=O["".concat(d,"-").concat(c,"-colgroup")];h&&_xeUtils.default.arrayEach(h.children,function(e){var t=e.getAttribute("name");if("col-gutter"===t&&(e.width="".concat(U||"")),p[t]){var o,l=p[t].column,i=l.showHeaderOverflow,n=l.showOverflow,r=l.renderWidth;e.width="".concat(l.renderWidth||"");var s="title"===(o="header"===c?_xeUtils.default.isUndefined(i)||_xeUtils.default.isNull(i)?_:i:_xeUtils.default.isUndefined(n)||_xeUtils.default.isNull(n)?y:n)||(!0===o||"complete"===o)||"tooltip"===o||"ellipsis"===o,a=O["".concat(d,"-").concat(c,"-list")];a&&s&&_xeUtils.default.arrayEach(a.querySelectorAll(".".concat(l.id)),function(e){var t=e.querySelector(".s-cell");t&&(t.style.width="".concat(b?r-1:r,"px"))})}})})}),o&&this.setCurrentRow(o),this.$nextTick()},checkScrolling:function(){var e=this.$refs,t=e.tableBody,o=e.leftContainer,l=e.rightContainer,i=t?t.$el:null;i&&(o&&_tools.DomTools[0<i.scrollLeft?"addClass":"removeClass"](o,"scrolling--middle"),l&&_tools.DomTools[i.clientWidth<i.scrollWidth-i.scrollLeft?"addClass":"removeClass"](l,"scrolling--middle"))},preventEvent:function(t,e,o,l){var i=this;_tableCore.Interceptor.get(e).some(function(e){return!1===e(o,t,i)})||l()},handleGlobalMousedownEvent:function(i){var n=this,r=this.$el,e=this.$refs,t=this.editStore,o=this.ctxMenuStore,l=this.editConfig,s=void 0===l?{}:l,a=this.filterStore,c=t.actived,u=e.filterWrapper,h=e.validTip;u&&(this.getEventTargetNode(i,r,"s-filter-wrapper").flag||this.getEventTargetNode(i,u.$el).flag||this.preventEvent(i,"event.clear_filter",a.args,this.closeFilter)),c.row&&!1!==s.autoClear&&(h&&this.getEventTargetNode(i,h.$el).flag||(!this.lastCallTime||this.lastCallTime+50<Date.now())&&this.preventEvent(i,"event.clear_actived",c.args,function(){var e,t=!n.getEventTargetNode(i,r,"col--edit").flag;if("row"===s.mode){var o=n.getEventTargetNode(i,r,"s-body--row"),l=o.flag?o.targetElem!==c.args.cell.parentNode:0;e="manual"===s.trigger?l:l&&t}else e=t;!e&&n.getEventTargetNode(i,r).flag||setTimeout(function(){return n.clearActived(i)})})),o.visible&&this.$refs.ctxWrapper&&!this.getEventTargetNode(i,this.$refs.ctxWrapper.$el).flag&&this.closeMenu()},handleGlobalBlurEvent:function(e){this.closeFilter(),this.closeMenu()},handleGlobalMousewheelEvent:function(e){this.clostTooltip(),this.closeMenu()},handleGlobalKeydownEvent:function(e){var t,o=this,l=this.isCtxMenu,i=this.ctxMenuStore,n=this.editStore,r=this.mouseConfig,s=void 0===r?{}:r,a=this.keyboardConfig,c=void 0===a?{}:a,u=this.treeConfig,h=this.highlightCurrentRow,d=this.currentRow,f=n.selected,g=n.actived,m=e.keyCode,p=8===m,v=9===m,x=13===m,b=27===m,C=32===m,w=37===m,_=38===m,T=39===m,y=40===m,S=46===m,D=65===m,R=67===m,E=86===m,k=88===m,U=113===m,I=e.ctrlKey,$=w||_||T||y,O=l&&i.visible&&(x||C||$);if(b)this.closeMenu(),this.closeFilter(),g.row&&(t=g.args,this.clearActived(e),s.selected&&this.handleSelected(t,e));else if(x&&(c.isArrow||c.isTab)&&(f.row||g.row||u&&h&&d)){if(f.row||g.row)this.moveSelected(f.row?f.args:g.args,w,_,T,!0,e);else if(u&&h&&d){var M=d[u.children];if(M&&M.length){e.preventDefault();var N=M[0];t={$table:this,row:N},this.setTreeExpansion(d,!0).then(function(){return o.scrollToRow(N)}).then(function(){return o.triggerCurrentRowEvent(e,t)})}}}else if(O)e.preventDefault(),i.showChild&&_tools.UtilTools.hasChildrenList(i.selected)?this.moveCtxMenu(e,m,i,"selectChild",37,!1,i.selected.children):this.moveCtxMenu(e,m,i,"selected",39,!0,this.ctxMenuList);else if(U)f.row&&f.column&&(e.preventDefault(),this.handleActived(f.args,e));else if($&&c.isArrow)f.row&&f.column?this.moveSelected(f.args,w,_,T,y,e):(_||y)&&h&&d&&this.moveCurrentRow(_,y,e);else if(v&&c.isTab)f.row||f.column?this.moveTabSelected(f.args,e):(g.row||g.column)&&this.moveTabSelected(g.args,e);else if(S||(u&&h&&d?p&&c.isArrow:p)){if(c.isDel&&(f.row||f.column))_tools.UtilTools.setCellValue(f.row,f.column,null),p&&this.handleActived(f.args,e);else if(p&&c.isArrow&&u&&h&&d){var F=_xeUtils.default.findTree(this.afterFullData,function(e){return e===d},u).parent;F&&(e.preventDefault(),t={$table:this,row:F},this.setTreeExpansion(F,!1).then(function(){return o.scrollToRow(F)}).then(function(){return o.triggerCurrentRowEvent(e,t)}))}}else c.isCut&&I&&(D||k||R||E)?D?this.handleAllChecked(e):k||R?this.handleCopyed(k,e):this.handlePaste(e):c.isEdit&&!I&&(48<=m&&m<=57||65<=m&&m<=90||96<=m&&m<=111||186<=m&&m<=192||219<=m&&m<=222||32===m)&&f.column&&f.row&&f.column.editRender&&(c.editMethod&&!1===c.editMethod(f.args,e)||(_tools.UtilTools.setCellValue(f.row,f.column,null),this.handleActived(f.args,e)))},moveTabSelected:function(e,t){var o,l,i,n,r=this.tableData,s=this.visibleColumn,a=this.editConfig,c=this.hasIndexColumn,u=t.shiftKey,h=Object.assign({},e),d=r.indexOf(h.row),f=s.indexOf(h.column);if(t.preventDefault(),u){for(var g=f-1;0<=g;g--)if(!c(s[g])){i=s[n=g];break}if(!i&&0<d){o=r[l=d-1];for(var m=s.length-1;0<=m;m--)if(!c(s[m])){i=s[n=m];break}}}else{for(var p=f+1;p<s.length;p++)if(!c(s[p])){i=s[n=p];break}if(!i&&d<r.length-1){o=r[l=d+1];for(var v=0;v<s.length;v++)if(!c(s[v])){i=s[n=v];break}}}i&&(o?(h.rowIndex=l,h.row=o):h.rowIndex=d,h.columnIndex=n,h.column=i,h.cell=_tools.DomTools.getCell(this,h),a&&("click"!==a.trigger&&"dblclick"!==a.trigger||("row"===a.mode?this.handleActived(h,t):(this.handleSelected(h,t),this.scrollToRow(h.row,h.column)))))},moveCurrentRow:function(e,t,o){var l,i=this,n=this.currentRow,r=this.treeConfig,s=this.afterFullData;if(o.preventDefault(),r){var a=_xeUtils.default.findTree(s,function(e){return e===n},r),c=a.index,u=a.items;e&&0<c?l=u[c-1]:t&&c<u.length-1&&(l=u[c+1])}else{var h=s.indexOf(n);e&&0<h?l=s[h-1]:t&&h<s.length-1&&(l=s[h+1])}if(l){var d={$table:this,row:l};this.scrollToRow(l).then(function(){return i.triggerCurrentRowEvent(o,d)})}},moveSelected:function(e,t,o,l,i,n){var r=this.tableData,s=this.visibleColumn,a=this.hasIndexColumn,c=Object.assign({},e);if(n.preventDefault(),o&&c.rowIndex)c.rowIndex-=1,c.row=r[c.rowIndex];else if(i&&c.rowIndex<r.length-1)c.rowIndex+=1,c.row=r[c.rowIndex];else if(t&&c.columnIndex){for(var u=c.columnIndex-1;0<=u;u--)if(!a(s[u])){c.columnIndex=u,c.column=s[u];break}}else if(l)for(var h=c.columnIndex+1;h<s.length;h++)if(!a(s[h])){c.columnIndex=h,c.column=s[h];break}c.cell=_tools.DomTools.getCell(this,c),this.handleSelected(c,n),this.scrollToRow(c.row,c.column)},moveCtxMenu:function(e,t,o,l,i,n,r){var s,a=_xeUtils.default.findIndexOf(r,function(e){return o[l]===e});if(t===i)n&&_tools.UtilTools.hasChildrenList(o.selected)?o.showChild=!0:(o.showChild=!1,o.selectChild=null);else if(38===t){for(var c=a-1;0<=c;c--)if(!1!==r[c].visible){s=r[c];break}o[l]=s||r[r.length-1]}else if(40===t){for(var u=a+1;u<r.length;u++)if(!1!==r[u].visible){s=r[u];break}o[l]=s||r[0]}else!o[l]||13!==t&&32!==t||this.ctxMenuLinkEvent(e,o[l])},handleGlobalResizeEvent:function(){this.recalculate()},handleGlobalContextmenuEvent:function(e){var t=this.isCtxMenu,o=this.ctxMenuStore,l=this.ctxMenuOpts,i=["header","body","footer"];if(t){if(o.visible&&o.visible&&this.$refs.ctxWrapper&&this.getEventTargetNode(e,this.$refs.ctxWrapper.$el).flag)return void e.preventDefault();for(var n=0;n<i.length;n++){var r=i[n],s=this.getEventTargetNode(e,this.$el,"s-".concat(r,"--column")),a={type:r,$table:this};if(s.flag){var c=s.targetElem,u=this.getColumnNode(c).item,h="".concat(r,"-");if(Object.assign(a,{column:u,columnIndex:this.getColumnIndex(u),cell:c}),"body"===r){var d=this.getRowNode(c.parentNode).item;h="",a.row=d,a.rowIndex=this.getRowIndex(d)}return this.openContextMenu(e,r,a),void _tools.UtilTools.emitEvent(this,"".concat(h,"cell-context-menu"),[a,e])}if(this.getEventTargetNode(e,this.$el,"s-table--".concat(r,"-wrapper")).flag)return void("cell"===l.trigger?e.preventDefault():this.openContextMenu(e,r,a))}}this.closeMenu(),this.closeFilter()},openContextMenu:function(n,e,t){var r=this,s=this.ctxMenuStore,o=this.ctxMenuOpts,l=o[e],i=o.visibleMethod;if(l){var a=l.options;if(l.disabled)n.preventDefault();else if(a&&a.length)if(!i||i(t,n)){n.preventDefault();var c=_tools.DomTools.getDomNode(),u=c.scrollTop,h=c.scrollLeft,d=c.visibleHeight,f=c.visibleWidth,g=n.clientY+u,m=n.clientX+h;Object.assign(s,{args:t,visible:!0,list:a,selected:null,selectChild:null,showChild:!1,style:{top:"".concat(g,"px"),left:"".concat(m,"px")}}),this.$nextTick(function(){var e=r.$refs.ctxWrapper.$el,t=e.clientHeight,o=e.clientWidth,l=n.clientY+t-d,i=n.clientX+o-f;-10<l&&(s.style.top="".concat(g-t,"px")),-10<i&&(s.style.left="".concat(m-o,"px"))})}else this.closeMenu()}this.closeFilter()},closeMenu:function(){return Object.assign(this.ctxMenuStore,{visible:!1,selected:null,selectChild:null,showChild:!1}),this.$nextTick()},ctxMenuMouseoverEvent:function(e,t,o){var l=this.ctxMenuStore;e.preventDefault(),e.stopPropagation(),l.selected=t,(l.selectChild=o)||(l.showChild=_tools.UtilTools.hasChildrenList(t))},ctxMenuMouseoutEvent:function(e,t,o){var l=this.ctxMenuStore;t.children||(l.selected=null),l.selectChild=null},ctxMenuLinkEvent:function(e,t){t.disabled||t.children&&t.children.length||(_tools.UtilTools.emitEvent(this,"context-menu-click",[Object.assign({menu:t,$table:this},this.ctxMenuStore.args),e]),this.closeMenu())},triggerCompleteEvent:function(e,t){var o=this.editConfig,l=this.editStore.actived,i=t.row,n=t.column,r=t.locationType;o&&("row"===o.mode&&l.row===i||l.row===i&&l.column===n)||this.showComplete(e,n,r)},showComplete:function(e,t,o){if(e.currentTarget.querySelector(".s-table-grid-down"))return this.$nextTick();var l=this.$refs["s-table-complete"],i=e.currentTarget,n=this,r=i.children[0],s=i.innerText,a=r.innerHTML;if(s&&r.scrollWidth>r.clientWidth){var c=document.createElement("div");c.className="s-table-grid-down",c.innerHTML='<i class="s-icon--arrow-bottom"></i>',i.appendChild(c),c.addEventListener("click",function(){var e;l.style.display="block";0<_tools.DomTools.getParents(n.$el,".s-table-complete-outline").length?(e=_tools.DomTools.getOffsetPos(i,_tools.DomTools.getParents(n.$el,".s-table-complete-outline")[0].children[0]),"body"===o&&(e.top-=n.$refs.tableBody.$el.scrollTop),t.fixed||(e.left-=n.$refs.tableBody.$el.scrollLeft),e.left+Math.min(r.scrollWidth,500)>_tools.DomTools.getParents(n.$el,".s-table-complete-outline")[0].children[0].scrollWidth&&(e.left-=Math.min(r.scrollWidth,500)-r.clientWidth)):e=_tools.DomTools.getAbsolutePos(i),l.style.top=e.top+"px",l.style.left=e.left+"px",l.style.maxWidth=1e4+"px",l.querySelector(".s-table--complete-main").innerHTML=a},!1)}},closeComplete:function(e){var t=e.currentTarget.querySelector(".s-table-grid-down");t&&t.parentNode.removeChild(t)},triggerHeaderTooltipEvent:function(e,t){var o=this.tooltipStore,l=t.column;o.column===l&&o.visible||this.showTooltip(e,l)},triggerFooterTooltipEvent:function(e,t){var o=t.column,l=this.tooltipStore;l.column===o&&l.visible||this.showTooltip(e,o)},triggerTooltipEvent:function(e,t){var o=this.editConfig,l=this.editStore,i=this.tooltipStore,n=l.actived,r=t.row,s=t.column;o&&("row"===o.mode&&n.row===r||n.row===r&&n.column===s)||i.column===s&&i.row===r&&i.visible||this.showTooltip(e,s,r)},showTooltip:function(e,t,o){var l=e.currentTarget,i=this.$refs.tooltip,n=l.children[0],r=l.innerText;return r&&n.scrollWidth>n.clientWidth&&(Object.assign(this.tooltipStore,{row:o,column:t,visible:!0}),i&&i.toVisible(l,_tools.UtilTools.formatText(r))),this.$nextTick()},clostTooltip:function(){var e=this.$refs.tooltip;return Object.assign(this.tooltipStore,{row:null,column:null,content:null,visible:!1}),e&&e.close(),this.$nextTick()},handleSelectionDefChecked:function(){var e=this.selectConfig,t=void 0===e?{}:e,o=this.fullDataRowIdData,l=t.checkAll,i=t.checkRowKeys;if(l)this.setAllSelection(!0);else if(i){var n=[];i.forEach(function(e){o[e]&&n.push(o[e].row)}),this.setSelection(n,!0)}},setSelection:function(e,t){var o=this;return e&&!_xeUtils.default.isArray(e)&&(e=[e]),e.forEach(function(e){return o.handleSelectRow({row:e},!!t)}),this.$nextTick()},handleSelectRow:function(e,o){var l=e.row,i=this.selection,t=this.tableFullData,n=this.selectConfig,r=void 0===n?{}:n,s=this.treeConfig,a=this.treeIndeterminates,c=r.checkField,u=r.checkStrictly,h=r.checkMethod;if(c)if(s&&!u){-1===o?(a.push(l),_xeUtils.default.set(l,c,!1)):(_xeUtils.default.eachTree([l],function(e,t){l!==e&&h&&!h({row:e,$rowIndex:t})||_xeUtils.default.set(e,c,o)},s),_xeUtils.default.remove(a,function(e){return e===l}));var d=_xeUtils.default.findTree(t,function(e){return e===l},s);if(d&&d.parent){var f,g=h?d.items.filter(function(e,t){return h({row:e,$rowIndex:t})}):d.items;if(d.items.find(function(e){return-1<a.indexOf(e)}))f=-1;else{var m=d.items.filter(function(e){return _xeUtils.default.get(e,c)});f=m.filter(function(e){return-1<g.indexOf(e)}).length===g.length||!(!m.length&&-1!==o)&&-1}return this.handleSelectRow({row:d.parent},f)}}else _xeUtils.default.set(l,c,o);else if(s&&!u){-1===o?(a.push(l),_xeUtils.default.remove(i,function(e){return e===l})):(_xeUtils.default.eachTree([l],function(t,e){l!==t&&h&&!h({row:t,$rowIndex:e})||(o?i.push(t):_xeUtils.default.remove(i,function(e){return e===t}))},s),_xeUtils.default.remove(a,function(e){return e===l}));var p=_xeUtils.default.findTree(t,function(e){return e===l},s);if(p&&p.parent){var v,x=h?p.items.filter(function(e,t){return h({row:e,$rowIndex:t})}):p.items;if(p.items.find(function(e){return-1<a.indexOf(e)}))v=-1;else{var b=p.items.filter(function(e){return-1<i.indexOf(e)});v=b.filter(function(e){return-1<x.indexOf(e)}).length===x.length||!(!b.length&&-1!==o)&&-1}return this.handleSelectRow({row:p.parent},v)}}else o?-1===i.indexOf(l)&&i.push(l):_xeUtils.default.remove(i,function(e){return e===l});this.checkSelectionStatus()},handleToggleCheckRowEvent:function(e,t){var o=this.selectConfig,l=void 0===o?{}:o,i=this.selection,n=l.checkField,r=e.row,s=n?!_xeUtils.default.get(r,n):-1===i.indexOf(r);t?this.triggerCheckRowEvent(t,e,s):this.handleSelectRow(e,s)},triggerCheckRowEvent:function(e,t,o){this.handleSelectRow(t,o),_tools.UtilTools.emitEvent(this,"select-change",[Object.assign({selection:this.getSelectRecords(),checked:o,$table:this},t),e])},toggleRowSelection:function(e){return this.handleToggleCheckRowEvent({row:e}),this.$nextTick()},setAllSelection:function(o){var e=this.tableFullData,t=this.editStore,l=this.selectConfig,i=void 0===l?{}:l,n=this.treeConfig,r=this.selection,s=i.checkField,a=i.reserve,c=i.checkStrictly,u=i.checkMethod,h=t.insertList,d=[];if(h.length&&(e=e.concat(h)),!c){if(s){var f="".concat(n?"$":"","rowIndex"),g=function(e,t){u&&!u(_defineProperty({row:e},f,t))||_xeUtils.default.set(e,s,o)},m=function(e,t){(!u||!u(_defineProperty({row:e},f,t))&&-1<r.indexOf(e))&&_xeUtils.default.set(e,s,o)};n?_xeUtils.default.eachTree(e,o?g:m,n):e.forEach(o?g:m)}else n?o?_xeUtils.default.eachTree(e,function(e,t){u&&!u({row:e,$rowIndex:t})||d.push(e)},n):u&&_xeUtils.default.eachTree(e,function(e,t){!u({row:e,$rowIndex:t})&&-1<r.indexOf(e)&&d.push(e)},n):o?d=u?e.filter(function(e,t){return-1<r.indexOf(e)||u({row:e,rowIndex:t})}):e.slice(0):u&&(d=e.filter(function(e,t){return u({row:e,rowIndex:t})?0:-1<r.indexOf(e)}));this.selection=o&&a?r.concat(d.filter(function(e){return-1===r.indexOf(e)})):d}this.treeIndeterminates=[],this.checkSelectionStatus()},checkSelectionStatus:function(){var e=this.tableFullData,t=this.editStore,o=this.selectConfig,l=void 0===o?{}:o,i=this.selection,n=this.treeIndeterminates,r=l.checkField,s=l.checkStrictly,a=l.checkMethod,c=t.insertList;c.length&&(e=e.concat(c)),s||(r?(this.isAllSelected=e.length&&e.every(a?function(e,t){return!a({row:e,rowIndex:t})||_xeUtils.default.get(e,r)}:function(e){return _xeUtils.default.get(e,r)}),this.isIndeterminate=!this.isAllSelected&&e.some(function(e){return _xeUtils.default.get(e,r)||-1<n.indexOf(e)})):(this.isAllSelected=e.length&&e.every(a?function(e,t){return!a({row:e,rowIndex:t})||-1<i.indexOf(e)}:function(e){return-1<i.indexOf(e)}),this.isIndeterminate=!this.isAllSelected&&e.some(function(e){return-1<n.indexOf(e)||-1<i.indexOf(e)})))},reserveCheckSelection:function(){var e=this.selectConfig,t=void 0===e?{}:e,o=this.selection,l=this.fullDataRowIdData,i=t.reserve,n=_tools.UtilTools.getRowkey(this);i&&o.length&&(this.selection=o.map(function(e){var t=""+_xeUtils.default.get(e,n);return l[t]?l[t].row:e}))},triggerCheckAllEvent:function(e,t){this.setAllSelection(t),_tools.UtilTools.emitEvent(this,"select-all",[{selection:this.getSelectRecords(),checked:t,$table:this},e])},toggleAllSelection:function(){return this.triggerCheckAllEvent(null,!this.isAllSelected),this.$nextTick()},clearSelection:function(){var e=this.tableFullData,t=this.selectConfig,o=void 0===t?{}:t,l=this.treeConfig,i=o.checkField;return i&&(l?_xeUtils.default.eachTree(e,function(e){return _xeUtils.default.set(e,i,!1)},l):e.forEach(function(e){return _xeUtils.default.set(e,i,!1)})),this.isAllSelected=!1,this.isIndeterminate=!1,this.selection=[],this.treeIndeterminates=[],this.$nextTick()},handleRadioDefChecked:function(){var e=this.radioConfig,t=void 0===e?{}:e,o=this.fullDataRowIdData,l=t.checkRowKey;l&&o[l]&&this.setRadioRow(o[l].row)},triggerRadioRowEvent:function(e,t){var o=this.selectRow!==t.row;this.setRadioRow(t.row),o&&_tools.UtilTools.emitEvent(this,"radio-change",[t,e])},triggerCurrentRowEvent:function(e,t){var o=this.currentRow!==t.row;this.setCurrentRow(t.row),o&&_tools.UtilTools.emitEvent(this,"current-change",[t,e])},setCurrentRow:function(e){return this.clearCurrentRow(),this.clearCurrentColumn(),this.currentRow=e,this.highlightCurrentRow&&_xeUtils.default.arrayEach(this.$el.querySelectorAll('[data-rowid="'.concat(_tools.UtilTools.getRowid(this,e),'"]')),function(e){return _tools.DomTools.addClass(e,"row--current")}),this.$nextTick()},setRadioRow:function(e){return this.selectRow!==e&&this.clearRadioRow(),this.selectRow=e,this.$nextTick()},clearCurrentRow:function(){return this.currentRow=null,this.hoverRow=null,_xeUtils.default.arrayEach(this.$el.querySelectorAll(".row--current"),function(e){return _tools.DomTools.removeClass(e,"row--current")}),this.$nextTick()},clearRadioRow:function(){return this.selectRow=null,this.$nextTick()},getCurrentRow:function(){return this.currentRow},getRadioRow:function(){return this.selectRow},triggerHoverEvent:function(e,t){var o=t.row;this.setHoverRow(o)},setHoverRow:function(e){var t=_tools.UtilTools.getRowid(this,e);this.clearHoverRow(),_xeUtils.default.arrayEach(this.$el.querySelectorAll('[data-rowid="'.concat(t,'"]')),function(e){return _tools.DomTools.addClass(e,"row--hover")}),this.hoverRow=e},clearHoverRow:function(){_xeUtils.default.arrayEach(this.$el.querySelectorAll(".s-body--row.row--hover"),function(e){return _tools.DomTools.removeClass(e,"row--hover")}),this.hoverRow=null},triggerHeaderCellMousedownEvent:function(e,t){var a=this.$el,o=this.tableData,l=this.mouseConfig,i=void 0===l?{}:l,n=this.elemStore,c=this.handleChecked,u=this.handleHeaderChecked,r=e.button,s=t.column,h=t.cell,d=0===r,f="index"===s.type;if(d&&i.checked){var g=n["main-header-list"].children,m=n["main-body-list"].children;if(f)this.handleAllChecked(e);else{e.preventDefault(),e.stopPropagation(),this.clearSelected(e),this.clearHeaderChecked(),this.clearIndexChecked();var p=document.onmousemove,v=document.onmouseup,x=m[0].querySelector(".".concat(s.id)),b=_xeUtils.default.throttle(function(e){e.preventDefault();var t=_tools.DomTools.getEventTargetNode(e,a,"s-header--column"),o=t.flag,l=t.targetElem;if(!o){var i=_tools.DomTools.getEventTargetNode(e,a,"s-body--column");o=i.flag,l=i.targetElem}if(o&&!_tools.DomTools.hasClass(l,"col--index")){var n=[].indexOf.call(l.parentNode.children,l),r=m[m.length-1].children[n],s=g[0].children[n];u(_tools.DomTools.getRowNodes(g,_tools.DomTools.getCellNodeIndex(s),_tools.DomTools.getCellNodeIndex(h))),c(_tools.DomTools.getRowNodes(m,_tools.DomTools.getCellNodeIndex(x),_tools.DomTools.getCellNodeIndex(r)))}},80,{leading:!0,trailing:!0});if(_tools.DomTools.addClass(a,"c--checked"),document.onmousemove=b,document.onmouseup=function(){_tools.DomTools.removeClass(a,"c--checked"),document.onmousemove=p,document.onmouseup=v},u([[h]]),m.length){var C=m[m.length-1].querySelector(".".concat(s.id)),w=m[0],_=m[m.length-1],T=w.querySelector(".col--index");t.rowIndex=0,t.row=o[0],t.cell=_tools.DomTools.getCell(this,t),this.handleSelected(t,e),this.handleIndexChecked(_tools.DomTools.getRowNodes(m,_tools.DomTools.getCellNodeIndex(T),_tools.DomTools.getCellNodeIndex(_.querySelector(".col--index")))),this.handleChecked(_tools.DomTools.getRowNodes(m,_tools.DomTools.getCellNodeIndex(x),_tools.DomTools.getCellNodeIndex(C)))}}this.closeMenu()}},triggerCellMousedownEvent:function(e,t){var a=this.$el,o=this.tableData,l=this.visibleColumn,i=this.editStore,n=this.editConfig,r=this.handleSelected,s=this.mouseConfig,c=void 0===s?{}:s,u=this.handleChecked,h=this.handleIndexChecked,d=this.handleHeaderChecked,f=this.elemStore,g=i.checked,m=i.actived,p=t.row,v=t.column,x=t.cell,b=0===e.button;if(n){if(m.row!==p||"cell"!==n.mode||m.column!==v)if(b&&c.checked){e.preventDefault(),e.stopPropagation(),this.clearHeaderChecked(),this.clearIndexChecked();var C=document.onmousemove,w=document.onmouseup,_=_tools.DomTools.getCellNodeIndex(x),T="index"===v.type,y=f["main-body-list"].children,S=f["main-header-list"].children,D=x.parentNode.lastElementChild,R=x.parentNode.firstElementChild,E=[].indexOf.call(x.parentNode.children,x),k=S[0].children[E],U=_xeUtils.default.throttle(function(e){e.preventDefault();var t=_tools.DomTools.getEventTargetNode(e,a,"s-body--column"),o=t.flag,l=t.targetElem;if(o)if(T){var i=l.parentNode.firstElementChild;u(_tools.DomTools.getRowNodes(y,_tools.DomTools.getCellNodeIndex(i.nextElementSibling),_tools.DomTools.getCellNodeIndex(D))),h(_tools.DomTools.getRowNodes(y,_tools.DomTools.getCellNodeIndex(i),_tools.DomTools.getCellNodeIndex(x)))}else if(!_tools.DomTools.hasClass(l,"col--index")){var n=l.parentNode.firstElementChild,r=[].indexOf.call(l.parentNode.children,l),s=S[0].children[r];d(_tools.DomTools.getRowNodes(S,_tools.DomTools.getCellNodeIndex(s),_tools.DomTools.getCellNodeIndex(k))),h(_tools.DomTools.getRowNodes(y,_tools.DomTools.getCellNodeIndex(n),_tools.DomTools.getCellNodeIndex(R))),u(_tools.DomTools.getRowNodes(y,_,_tools.DomTools.getCellNodeIndex(l)))}},80,{leading:!0,trailing:!0});if(document.onmousemove=U,document.onmouseup=function(e){document.onmousemove=C,document.onmouseup=w},T){var I=x.parentNode.firstElementChild;t.columnIndex++,t.column=l[t.columnIndex],t.cell=x.nextElementSibling,r(t,e),u(_tools.DomTools.getRowNodes(y,_tools.DomTools.getCellNodeIndex(I.nextElementSibling),_tools.DomTools.getCellNodeIndex(D))),d([S[0].querySelectorAll(".s-header--column:not(.col--index)")]),h(_tools.DomTools.getRowNodes(y,_tools.DomTools.getCellNodeIndex(I),_tools.DomTools.getCellNodeIndex(x)))}else r(t,e);this.closeFilter(),this.closeMenu()}else if(c.selected&&"dblclick"===n.trigger){var $=_tools.DomTools.getCellIndexs(x);-1!==g.rows.indexOf(o[$.rowIndex])&&-1!==g.columns.indexOf(l[$.columnIndex])||r(t,e)}}else c.selected&&r(t,e)},triggerHeaderCellClickEvent:function(e,t){var o=this._lastResizeTime,l=this.sortOpts,i=t.column,n=t.cell,r=o&&o>Date.now()-300,s=this.getEventTargetNode(e,n,"s-sort-wrapper").flag,a=this.getEventTargetNode(e,n,"s-filter-wrapper").flag;return"cell"!==l.trigger||r||s||a||this.sort(i.property),_tools.UtilTools.emitEvent(this,"header-cell-click",[Object.assign({triggerResizable:r,triggerSort:s,triggerFilter:a},t),e]),this.highlightCurrentColumn?this.setCurrentColumn(i,!0):this.$nextTick()},setCurrentColumn:function(e){return this.clearCurrentRow(),this.clearCurrentColumn(),this.currentColumn=e,_xeUtils.default.arrayEach(this.$el.querySelectorAll(".".concat(e.id)),function(e){return _tools.DomTools.addClass(e,"col--current")}),this.$nextTick()},clearCurrentColumn:function(){return this.currentColumn=null,_xeUtils.default.arrayEach(this.$el.querySelectorAll(".col--current"),function(e){return _tools.DomTools.removeClass(e,"col--current")}),this.$nextTick()},triggerCellClickEvent:function(e,t){var o=this,l=this.$el,i=this.highlightCurrentRow,n=this.editStore,r=this.radioConfig,s=void 0===r?{}:r,a=this.selectConfig,c=void 0===a?{}:a,u=this.treeConfig,h=void 0===u?{}:u,d=this.editConfig,f=this.mouseConfig,g=void 0===f?{}:f,m=n.actived,p=t.column,v=t.cell;("row"===h.trigger||p.treeNode&&"cell"===h.trigger)&&this.triggerTreeExpandEvent(e,t),p.treeNode&&this.getEventTargetNode(e,l,"s-tree-wrapper").flag||(i&&("row"!==s.trigger&&(this.getEventTargetNode(e,l,"s-checkbox").flag||this.getEventTargetNode(e,l,"s-radio").flag)||this.triggerCurrentRowEvent(e,t)),"row"!==s.trigger&&("radio"!==p.type||"cell"!==s.trigger)||this.getEventTargetNode(e,l,"s-radio").flag||this.triggerRadioRowEvent(e,t),"row"!==c.trigger&&("selection"!==p.type||"cell"!==c.trigger)||this.getEventTargetNode(e,t.cell,"s-checkbox").flag||this.handleToggleCheckRowEvent(t,e),g.checked||d&&(m.args&&v===m.args.cell||("click"===d.trigger?this.triggerValidate("blur").catch(function(e){return e}).then(function(){o.handleActived(t,e).then(function(){return o.triggerValidate("change")}).catch(function(e){return e})}):"dblclick"===d.trigger&&("row"===d.mode&&m.row===t.row?this.triggerValidate("blur").catch(function(e){return e}).then(function(){o.handleActived(t,e).then(function(){return o.triggerValidate("change")}).catch(function(e){return e})}):this.handleSelected(t,e))))),_tools.UtilTools.emitEvent(this,"cell-click",[t,e])},triggerCellDBLClickEvent:function(e,t){var o=this,l=this.editStore,i=this.editConfig,n=l.actived;i&&"dblclick"===i.trigger&&(n.args&&e.currentTarget===n.args.cell||("row"===i.mode?this.triggerValidate("blur").catch(function(e){return e}).then(function(){o.handleActived(t,e).then(function(){return o.triggerValidate("change")}).catch(function(e){return e})}):"cell"===i.mode&&this.handleActived(t,e).then(function(){return o.triggerValidate("change")}).catch(function(e){return e}))),_tools.UtilTools.emitEvent(this,"cell-dblclick",[t,e])},handleActived:function(e,t){var o=this,l=this.editStore,i=this.editConfig,n=this.tableColumn,r=i.activeMethod,s=l.actived,a=e.row,c=e.column,u=e.cell,h=c.model;if(c.editRender&&u)if(s.row!==a||"cell"===i.mode&&s.column!==c){var d="edit-disabled";r&&!r(e)||(this.clostTooltip(),this.clearCopyed(t),this.clearChecked(),this.clearSelected(t),this.clearActived(t),d="edit-actived",c.renderHeight=u.offsetHeight,s.args=e,s.row=a,s.column=c,"row"===i.mode?n.forEach(function(e){e.editRender&&(e.model.value=_tools.UtilTools.getCellValue(a,e),e.model.update=!1)}):(h.value=_tools.UtilTools.getCellValue(a,c),h.update=!1),this.$nextTick(function(){o.handleFocus(e,t)})),_tools.UtilTools.emitEvent(this,d,[e,t])}else{var f=s.column;if(f!==c){var g=f.model;g.update&&_tools.UtilTools.setCellValue(a,f,g.value),this.clearValidate()}c.renderHeight=u.offsetHeight,s.args=e,s.column=c,setTimeout(function(){o.handleFocus(e,t)})}return this.$nextTick()},clearActived:function(e){var t=this.editStore.actived,o=t.args,l=t.row,i=t.column;if(l||i){var n=i.model;n.update&&(_tools.UtilTools.setCellValue(l,i,n.value),n.update=!1,n.value=null,this.updateFooter()),_tools.UtilTools.emitEvent(this,"edit-closed",[o,e])}return t.args=null,t.row=null,t.column=null,this.clearValidate().then(this.recalculate)},getActiveRow:function(){var e=this.$el,t=this.editStore,o=this.tableData,l=t.actived,i=l.args,n=l.row;return i&&-1<o.indexOf(n)&&e.querySelectorAll(".s-body--column.col--actived").length?Object.assign({},i):null},hasActiveRow:function(e){return this.editStore.actived.row===e},clearSelected:function(e){var t=this.editStore,o=this.elemStore,l=t.selected;l.row=null,l.column=null;var i=o["main-header-list"],n=o["main-body-list"];return _xeUtils.default.arrayEach(i.querySelectorAll(".col--title-selected"),function(e){return _tools.DomTools.removeClass(e,"col--title-selected")}),_xeUtils.default.arrayEach([n.querySelector(".col--selected")],function(e){return _tools.DomTools.removeClass(e,"col--selected")}),this.$nextTick()},handleSelected:function(i,n){var r=this,e=this.mouseConfig,s=void 0===e?{}:e,a=this.editConfig,t=this.editStore,c=this.elemStore,u=t.actived,h=t.selected,d=i.row,f=i.column,g=i.cell;return function(){if((h.row!==d||h.column!==f)&&(u.row!==d||"cell"===a.mode&&u.column!==f)){if(r.clearChecked(n),r.clearIndexChecked(),r.clearHeaderChecked(),r.clearSelected(n),r.clearActived(n),h.args=i,h.row=d,h.column=f,s.selected){var e=c["main-body-list"],t=_tools.UtilTools.getRowid(r,d),o=e.querySelector('[data-rowid="'.concat(t,'"]')).querySelector(".".concat(f.id));_tools.DomTools.addClass(o,"col--selected")}if(s.checked){var l=c["main-header-list"];r.handleChecked([[g]]),r.handleHeaderChecked([[l.querySelector(".".concat(f.id))]]),r.handleIndexChecked([[g.parentNode.querySelector(".col--index")]])}}return r.$nextTick()}()},clearChecked:function(e){var t=this.$refs,o=this.editStore,l=this.mouseConfig,i=o.checked;if(l&&l.checked){var n=t.tableBody;i.rows=[],i.columns=[],i.tRows=[],i.tColumns=[],n.$refs.checkBorders.style.display="none",_xeUtils.default.arrayEach(n.$el.querySelectorAll(".col--checked"),function(e){return _tools.DomTools.removeClass(e,"col--checked")})}return this.$nextTick()},handleChecked:function(e){var t=this.editStore.checked;this.clearChecked();var i=-2,n=-2,r=0,s=0;_xeUtils.default.arrayEach(e,function(e,t){var l=0===t;_xeUtils.default.arrayEach(e,function(e,t){var o=0===t;o&&l&&(r=e.offsetTop,s=e.offsetLeft),l&&(i+=e.offsetWidth),o&&(n+=e.offsetHeight),_tools.DomTools.addClass(e,"col--checked")})});var o=this.$refs.tableBody.$refs,l=o.checkBorders,a=o.checkTop,c=o.checkRight,u=o.checkBottom,h=o.checkLeft;l.style.display="block",Object.assign(a.style,{top:"".concat(r,"px"),left:"".concat(s,"px"),width:"".concat(i,"px")}),Object.assign(c.style,{top:"".concat(r,"px"),left:"".concat(s+i,"px"),height:"".concat(n,"px")}),Object.assign(u.style,{top:"".concat(r+n,"px"),left:"".concat(s,"px"),width:"".concat(i,"px")}),Object.assign(h.style,{top:"".concat(r,"px"),left:"".concat(s,"px"),height:"".concat(n,"px")}),t.rowNodes=e},handleAllChecked:function(e){var t=this.tableData,o=this.visibleColumn,l=this.mouseConfig,i=void 0===l?{}:l,n=this.elemStore;if(i.checked){e.preventDefault();var r=n["main-header-list"],s=r.children,a=n["main-body-list"].children,c=o.find(function(e){return"index"===e.type})||o[0],u=r.querySelector(".".concat(c.id)),h=a[0],d=a[a.length-1],f=h.querySelector(".".concat(c.id)),g={$table:this,rowIndex:0,row:t[0],column:o.find(function(e){return e.property})};g.columnIndex=this.getColumnIndex(g.column),g.cell=_tools.DomTools.getCell(this,g),this.handleSelected(g,e),this.handleHeaderChecked(_tools.DomTools.getRowNodes(s,_tools.DomTools.getCellNodeIndex(u.nextElementSibling),_tools.DomTools.getCellNodeIndex(u.parentNode.lastElementChild))),this.handleIndexChecked(_tools.DomTools.getRowNodes(a,_tools.DomTools.getCellNodeIndex(f),_tools.DomTools.getCellNodeIndex(d.querySelector(".".concat(c.id))))),this.handleChecked(_tools.DomTools.getRowNodes(a,_tools.DomTools.getCellNodeIndex(f.nextElementSibling),_tools.DomTools.getCellNodeIndex(d.lastElementChild)))}},handleIndexChecked:function(e){var t=this.editStore.indexs;this.clearIndexChecked(),_xeUtils.default.arrayEach(e,function(e){_xeUtils.default.arrayEach(e,function(e){_tools.DomTools.addClass(e,"col--index-checked")})}),t.rowNodes=e},clearIndexChecked:function(){var e=this.elemStore["main-body-list"];return _xeUtils.default.arrayEach(e.querySelectorAll(".col--index-checked"),function(e){return _tools.DomTools.removeClass(e,"col--index-checked")}),this.$nextTick()},handleHeaderChecked:function(e){var t=this.editStore.titles;this.clearHeaderChecked(),_xeUtils.default.arrayEach(e,function(e){_xeUtils.default.arrayEach(e,function(e){_tools.DomTools.addClass(e,"col--title-checked")})}),t.rowNodes=e},clearHeaderChecked:function(){var e=this.elemStore["main-header-list"];return _xeUtils.default.arrayEach(e.querySelectorAll(".col--title-checked"),function(e){return _tools.DomTools.removeClass(e,"col--title-checked")}),this.$nextTick()},clearCopyed:function(){var e=this.$refs,t=this.editStore,o=this.keyboardConfig,l=t.copyed;if(o&&o.isCut){var i=e.tableBody,n=e.tableBody.$refs.copyBorders;l.cut=!1,l.rows=[],l.columns=[],n.style.display="none",_xeUtils.default.arrayEach(i.$el.querySelectorAll(".col--copyed"),function(e){return _tools.DomTools.removeClass(e,"col--copyed")})}return this.$nextTick()},handleCopyed:function(e,t){var o=this.tableData,l=this.tableColumn,i=this.editStore,n=i.copyed,r=i.checked.rowNodes;this.clearCopyed();var s=-3,a=-3,c=0,u=0,h=[],d=[];if(r.length){var f=r[0],g=_tools.DomTools.getCellNodeIndex(f[0]),m=g.rowIndex,p=g.columnIndex;h=l.slice(p,p+f.length),d=o.slice(m,m+r.length)}_xeUtils.default.arrayEach(r,function(e,t){var l=0===t;_xeUtils.default.arrayEach(e,function(e,t){var o=0===t;o&&l&&(c=e.offsetTop,u=e.offsetLeft),l&&(s+=e.offsetWidth),o&&(a+=e.offsetHeight),_tools.DomTools.addClass(e,"col--copyed")})});var v=this.$refs.tableBody.$refs,x=v.copyBorders,b=v.copyTop,C=v.copyRight,w=v.copyBottom,_=v.copyLeft;x.style.display="block",Object.assign(b.style,{top:"".concat(c,"px"),left:"".concat(u,"px"),width:"".concat(s,"px")}),Object.assign(C.style,{top:"".concat(c,"px"),left:"".concat(u+s,"px"),height:"".concat(a,"px")}),Object.assign(w.style,{top:"".concat(c+a,"px"),left:"".concat(u,"px"),width:"".concat(s,"px")}),Object.assign(_.style,{top:"".concat(c,"px"),left:"".concat(u,"px"),height:"".concat(a,"px")}),n.cut=e,n.rows=d,n.columns=h,n.rowNodes=r},handlePaste:function(e){var t=this.tableData,n=this.visibleColumn,o=this.editStore,l=this.elemStore,i=o.copyed,r=o.selected,s=i.cut,a=i.rows,c=i.columns;if(a.length&&c.length&&r.row&&r.column){var u=r.args,h=u.rowIndex,d=u.columnIndex;_xeUtils.default.arrayEach(a,function(l,e){var i=t[h+e];i&&_xeUtils.default.arrayEach(c,function(e,t){var o=n[d+t];o&&_tools.UtilTools.setCellValue(i,o,_tools.UtilTools.getCellValue(l,e)),s&&_tools.UtilTools.setCellValue(l,e,null)})}),s&&this.clearCopyed();var f=l["main-body-list"].children,g=r.args.cell,m=g.parentNode,p=_xeUtils.default.arrayIndexOf(m.children,g),v=f[_xeUtils.default.arrayIndexOf(f,m)+a.length-1].children[p+c.length-1];this.handleChecked(_tools.DomTools.getRowNodes(f,_tools.DomTools.getCellNodeIndex(g),_tools.DomTools.getCellNodeIndex(v)))}},handleFocus:function(e,t){var o=e.column,l=e.cell,i=o.editRender;if(i){var n,r=_tableCore.Renderer.get(i.name),s=i.autofocus,a=i.autoselect;if(s&&(n=l.querySelector(s)),!n&&r&&r.autofocus&&(n=l.querySelector(r.autofocus)),n&&(n[a?"select":"focus"](),browse.msie)){var c=n.createTextRange();c.collapse(!1),c.select()}}},setActiveRow:function(e){return this.setActiveCell(e,this.visibleColumn.find(function(e){return e.editRender}).property)},setActiveCell:function(o,l){var i=this;return this.scrollToRow(o,!0).then(function(){if(o&&l){var e=i.visibleColumn.find(function(e){return e.property===l});if(e&&e.editRender){var t=_tools.DomTools.getCell(i,{row:o,column:e});t&&(i.handleActived({row:o,rowIndex:i.getRowIndex(o),column:e,columnIndex:i.getColumnIndex(e),cell:t,$table:i}),i.lastCallTime=Date.now())}}return i.$nextTick()})},setSelectCell:function(e,t){var o=this.tableData,l=this.editConfig,i=this.visibleColumn;if(e&&t&&"manual"!==l.trigger){var n=i.find(function(e){return e.property===t}),r=o.indexOf(e);if(-1<r&&n){var s=_tools.DomTools.getCell(this,{row:e,rowIndex:r,column:n}),a={row:e,rowIndex:r,column:n,columnIndex:i.indexOf(n),cell:s};this.handleSelected(a,{})}}return this.$nextTick()},triggerSortEvent:function(e,t,o,l){t.order===l?this.clearSort(t.property):this.sort(t.property,l)},sort:function(t,e){var o=this.visibleColumn,l=this.tableFullColumn,i=this.remoteSort,n=o.find(function(e){return e.property===t}),r=_xeUtils.default.isBoolean(n.remoteSort)?n.remoteSort:i;return n.sortable||n.remoteSort?(e||(e="desc"===n.order?"asc":"desc"),n.order!==e&&(l.forEach(function(e){e.order=null}),n.order=e,r||this.handleData(!0),_tools.UtilTools.emitEvent(this,"sort-change",[{column:n,property:t,prop:t,field:t,order:e,$table:this}])),this.$nextTick().then(this.updateStyle)):this.$nextTick()},clearSort:function(e){var t=arguments.length?this.getColumnByField(e):null;return t?t.order=null:this.tableFullColumn.forEach(function(e){e.order=null}),this.handleData(!0)},filter:function(e,t){var o=this.getColumnByField(e),l=o.filters;if(t){var i=t(l);_xeUtils.default.isArray(i)&&(o.filters=_tools.UtilTools.getFilters(i))}return Promise.resolve(l)},triggerFilterEvent:function(e,t,o){var l=this.$refs,i=this.filterStore,n=this.overflowX,r=this.$el;if(i.column===t&&i.visible)i.visible=!1;else{var s=e.target,a=l.tableBody.$el,c=l.filterWrapper,u=_tools.DomTools.getOffsetPos(s),h=u.top,d=u.left;if(0<_tools.DomTools.getParents(r,".s-table-complete-outline").length){var f=_tools.DomTools.getOffsetPos(s,_tools.DomTools.getParents(r,".s-table-complete-outline")[0].children[0]),g=f.top,m=f.left;h=g,d=m}n&&(d-=a.scrollLeft),Object.assign(i,{args:o,multiple:t.filterMultiple,options:t.filters,column:t,style:{zIndex:_conf.default.tooltip.zIndex,top:"".concat(h+s.clientHeight+6,"px"),left:"".concat(d,"px")},visible:!0}),i.isAllSelected=i.options.every(function(e){return e.checked}),i.isIndeterminate=!i.isAllSelected&&i.options.some(function(e){return e.checked}),this.$nextTick(function(){var e=c.$el;i.style.top="".concat(h+s.clientHeight+6,"px"),i.style.left="".concat(d-e.clientWidth/2+10,"px")})}},confirmFilterEvent:function(e){var t=this.visibleColumn,o=this.filterStore,l=this.remoteFilter,i=this.scrollXLoad,n=this.scrollYLoad,r=o.column,s=r.property,a=[],c=[];r.filters.forEach(function(e){e.checked&&(a.push(e.value),c.push(e.data))}),o.visible=!1,l||this.handleData(!0);var u=[];t.filter(function(e){var t=e.property,o=e.filters,l=[],i=[];o&&o.length&&(o.forEach(function(e){e.checked&&(l.push(e.value),i.push(e.data))}),u.push({column:e,property:t,field:t,prop:t,values:l,datas:i}))}),_tools.UtilTools.emitEvent(this,"filter-change",[{column:r,property:s,field:s,prop:s,values:a,datas:c,filters:u,$table:this}]),(i||n)&&(this.clearScroll(),n&&this.updateScrollYSpace()),this.closeFilter(),this.$nextTick(this.recalculate)},closeFilter:function(e){return Object.assign(this.filterStore,{isAllSelected:!1,isIndeterminate:!1,options:[],visible:!1}),this.$nextTick()},resetFilterEvent:function(e){this.filterStore.options.forEach(function(e){e.checked=!1,e.data=e._data}),this.confirmFilterEvent(e)},clearFilter:function(e){var t=arguments.length?this.getColumnByField(e):null,o=this.filterStore,l=function(e){var t=e.filters;t&&t.length&&t.forEach(function(e){e.checked=!1,e.data=e._data})};return t?l(t):this.visibleColumn.forEach(l),t&&t===o.column||Object.assign(o,{isAllSelected:!1,isIndeterminate:!1,style:null,options:[],column:null,multiple:!1,visible:!1}),this.handleData(!0).then(this.recalculate)},triggerRowExpandEvent:function(e,t){var o=t.row,l=this.toggleRowExpansion(o);return _tools.UtilTools.emitEvent(this,"toggle-expand-change",[{row:o,rowIndex:this.getRowIndex(o),$table:this},e]),l},toggleRowExpansion:function(e){return this.setRowExpansion(e)},handleDefaultRowExpand:function(){var e=this.expandConfig,t=void 0===e?{}:e,o=this.tableFullData,l=this.fullDataRowIdData,i=t.expandAll,n=t.expandRowKeys;if(i)this.expandeds=o.slice(0);else if(n){var r=[];n.forEach(function(e){l[e]&&r.push(l[e].row)}),this.expandeds=r}},setAllRowExpansion:function(e){return this.expandeds=e?this.tableFullData.slice(0):[],this.$nextTick()},setRowExpansion:function(e,o){var l=this.expandeds,t=this.expandConfig,i=void 0===t?{}:t,n=1===arguments.length;return e&&(_xeUtils.default.isArray(e)||(e=[e]),i.accordion&&(l.length=0,e=e.slice(e.length-1,e.length)),e.forEach(function(e){var t=l.indexOf(e);-1<t?!n&&o||l.splice(t,1):(n||o)&&l.push(e)})),this.$nextTick()},hasRowExpand:function(e){return-1<this.expandeds.indexOf(e)},clearRowExpand:function(){return this.expandeds=[],this.$nextTick()},triggerTreeExpandEvent:function(e,t){var o=this,l=t.row,i=this.currentRow,n=this.currentColumn,r=this.toggleTreeExpansion(l);return _tools.UtilTools.emitEvent(this,"toggle-tree-change",[{row:l,rowIndex:this.getRowIndex(l),$table:this},e]),i?this.$nextTick(function(){return o.setCurrentRow(i)}):n&&this.$nextTick(function(){return o.setCurrentColumn(n)}),r},toggleTreeExpansion:function(e){return this.setTreeExpansion(e)},handleDefaultTreeExpand:function(){var l=this.treeConfig,i=this.tableFullData;if(l){var e=l.expandAll,t=l.expandRowKeys,n=l.children,r=[];if(e)_xeUtils.default.filterTree(i,function(e){var t=e[n];t&&t.length&&r.push(e)},l),this.treeExpandeds=r;else if(t){var s=_tools.UtilTools.getRowkey(this);t.forEach(function(t){var e=_xeUtils.default.findTree(i,function(e){return t===_xeUtils.default.get(e,s)},l),o=e?e.item[n]:0;o&&o.length&&r.push(e.item)}),this.treeExpandeds=r}}},setAllTreeExpansion:function(e){var t=this.tableFullData,o=this.treeConfig,l=o.children,i=[];return e&&_xeUtils.default.eachTree(t,function(e){var t=e[l];t&&t.length&&i.push(e)},o),this.treeExpandeds=i,this.$nextTick()},setTreeExpansion:function(e,i){var n=this.tableFullData,r=this.treeExpandeds,s=this.treeConfig,a=s.children,c=1===arguments.length;return e&&(_xeUtils.default.isArray(e)||(e=[e]),s.accordion&&(e=e.slice(e.length-1,e.length)),e.forEach(function(t){var e=t[a];if(e&&e.length){var o=r.indexOf(t);if(s.accordion){var l=_xeUtils.default.findTree(n,function(e){return e===t},s);_xeUtils.default.remove(r,function(e){return-1<l.items.indexOf(e)})}-1<o?!c&&i||r.splice(o,1):(c||i)&&r.push(t)}})),this.$nextTick()},hasTreeExpand:function(e){return-1<this.treeExpandeds.indexOf(e)},clearTreeExpand:function(){return this.treeExpandeds=[],this.$nextTick()},getVirtualScroller:function(){var e=this.$refs,t=this.scrollXLoad,o=this.scrollYLoad,l=e.tableBody.$el;return{scrollX:t,scrollY:o,scrollTop:l.scrollTop,scrollLeft:l.scrollLeft}},triggerScrollXEvent:function(e){for(var t=this.$refs,o=this.visibleColumn,l=this.scrollXStore,i=l.startIndex,n=l.renderSize,r=l.offsetSize,s=l.visibleSize,a=t.tableBody.$el.scrollLeft,c=0,u=0,h=!1,d=0;d<o.length;d++)if(a<(u+=o[d].renderWidth)){c=d;break}if(l.visibleIndex!==c){var f=Math.min(Math.floor((n-s)/2),s);l.visibleIndex>c?(h=c-r<=i)&&(l.startIndex=Math.max(0,c-Math.max(f,n-s))):(h=i+n<=c+s+r)&&(l.startIndex=Math.max(0,Math.min(o.length-n,c-f))),h&&this.updateScrollXData(),l.visibleIndex=c}this.clostTooltip()},triggerScrollYEvent:function(e){isWebkit&&this.scrollYStore.adaptive?this.loadScrollYData(e):this.debounceScrollY(e)},debounceScrollY:_xeUtils.default.debounce(function(e){this.loadScrollYData(e)},debounceScrollYDuration,{leading:!1,trailing:!0}),loadScrollYData:function(e){var t=this.afterFullData,o=this.scrollYStore,l=o.startIndex,i=o.renderSize,n=o.offsetSize,r=o.visibleSize,s=o.rowHeight,a=e.target.scrollTop,c=Math.ceil(a/s),u=!1;if(o.visibleIndex!==c){var h=Math.min(Math.floor((i-r)/2),r);o.visibleIndex>c?(u=c-n<=l)&&(o.startIndex=Math.max(0,c-Math.max(h,i-r))):(u=l+i<=c+r+n)&&(o.startIndex=Math.max(0,Math.min(t.length-i,c-h))),u&&this.updateScrollYData(),o.visibleIndex=c}},computeScrollLoad:function(){var x=this;return this.$nextTick().then(function(){var e=x.vSize,t=x.scrollXLoad,o=x.scrollYLoad,l=x.scrollYStore,i=x.scrollXStore,n=x.visibleColumn,r=x.optimizeOpts,s=r.scrollX,a=r.scrollY,c=x.$refs.tableBody,u=c?c.$el:null,h=x.$refs.tableHeader;if(u){if(t){var d=n[0],f=d?d.renderWidth:40,g=_xeUtils.default.toNumber(s.vSize||Math.ceil(u.clientWidth/f));i.visibleSize=g,s.oSize||(i.offsetSize=g),s.rSize||(i.renderSize=g+2),x.updateScrollXData()}else x.updateScrollXSpace();if(o){var m;if(a.rHeight)m=a.rHeight;else{var p=u.querySelector("tbody>tr");!p&&h&&(p=h.$el.querySelector("thead>tr")),p&&(m=p.clientHeight)}if(!m)switch(e){case"medium":m=44;break;case"small":m=40;break;case"mini":m=36;break;default:m=48}var v=_xeUtils.default.toNumber(a.vSize||Math.ceil(u.clientHeight/m));l.visibleSize=v,l.rowHeight=m,a.oSize||(l.offsetSize=v),a.rSize||(l.renderSize=browse.firefox?6*v:browse.edge?10*v:isWebkit?v+2:6*v),x.updateScrollYData()}else x.updateScrollYSpace()}x.$nextTick(x.updateStyle)})},updateScrollXData:function(){var e=this.visibleColumn,t=this.scrollXStore;this.tableColumn=e.slice(t.startIndex,t.startIndex+t.renderSize),this.updateScrollXSpace()},updateScrollXSpace:function(){var e=this.$refs,l=this.elemStore,t=this.visibleColumn,o=this.scrollXStore,i=this.scrollXLoad,n=this.tableWidth,r=this.scrollbarWidth,s=e.tableHeader,a=e.tableBody,c=e.tableFooter,u=s?s.$el.querySelector(".s-table--header"):null,h=a.$el.querySelector(".s-table--body"),d=c?c.$el.querySelector(".s-table--footer"):null,f=t.slice(0,o.startIndex).reduce(function(e,t){return e+t.renderWidth},0),g="";i&&(g="".concat(f,"px")),u&&(u.style.marginLeft=g),h.style.marginLeft=g,d&&(d.style.marginLeft=g);["main"].forEach(function(o){["header","body","footer"].forEach(function(e){var t=l["".concat(o,"-").concat(e,"-xSpace")];t&&(t.style.width=i?"".concat(n+("header"===e?r:0),"px"):"")})}),this.$nextTick(this.updateStyle)},updateScrollYData:function(){this.handleData(),this.updateScrollYSpace()},updateScrollYSpace:function(){var l=this.elemStore,e=this.scrollYStore,t=this.scrollYLoad,o=this.afterFullData.length*e.rowHeight,i=Math.max(e.startIndex*e.rowHeight,0),n="",r="";t&&(n="".concat(i,"px"),r="".concat(o,"px")),["main","left","right"].forEach(function(o){var e=l["".concat(o,"-body-table")];e&&(e.style.marginTop=n),["header","body","footer"].forEach(function(e){var t=l["".concat(o,"-").concat(e,"-ySpace")];t&&(t.style.height=r)})}),this.$nextTick(this.updateStyle)},scrollTo:function(e,t){var o=this.$refs.tableBody.$el;if(_xeUtils.default.isNumber(e)){var l=this.$refs.tableFooter;l?l.$el.scrollLeft=e:o.scrollLeft=e}if(_xeUtils.default.isNumber(t)){var i=this.$refs.rightBody;i&&(i.$el.scrollTop=t),o.scrollTop=t}return this.$nextTick()},scrollToRow:function(e,t,o){return e&&this.fullAllDataRowMap.has(e)&&_tools.DomTools.rowToVisible(this,e),this.scrollToColumn(t,o||_xeUtils.default.isBoolean(t))},scrollToColumn:function(e,t){var o=this;return e&&this.fullColumnMap.has(e)&&_tools.DomTools.colToVisible(this,e),t&&this.scrollYLoad?new Promise(function(e){return setTimeout(function(){return e(o.$nextTick())},50)}):this.$nextTick()},clearScroll:function(){var i=this;return Object.assign(this.scrollXStore,{startIndex:0}),Object.assign(this.scrollYStore,{startIndex:0}),this.$nextTick(function(){var e=i.$refs.tableBody,t=e?e.$el:null,o=i.$refs.tableFooter,l=o?o.$el:null;t&&(t.scrollTop=0,t.scrollLeft=0),l&&(l.scrollLeft=0)}),this.$nextTick()},updateFooter:function(){var e=this.showFooter,t=this.tableColumn,o=this.footerMethod;return e&&o&&(this.footerData=t.length?o({columns:t,data:this.tableFullData}):[]),this.$nextTick()},updateStatus:function(a,c){var u=this,h=!_xeUtils.default.isUndefined(c);return this.$nextTick().then(function(){var e=u.$refs,t=u.tableData,o=u.editRules,l=u.validStore;if(a&&e.tableBody&&o){var i=a.row,n=a.column;if(u.hasCellRules("change",i,n)){var r=t.indexOf(i),s=_tools.DomTools.getCell(u,{row:i,rowIndex:r,column:n});if(s)return u.validCellRules("change",i,n,c).then(function(){h&&l.visible&&_tools.UtilTools.setCellValue(i,n,c),u.clearValidate()}).catch(function(e){var t=e.rule;h&&_tools.UtilTools.setCellValue(i,n,c),u.showValidTooltip({rule:t,row:i,column:n,cell:s})})}}})},triggerValidate:function(l){var i=this,e=this.editConfig,t=this.editStore,o=this.editRules,n=this.validStore,r=t.actived;if(r.row&&o){var s=r.args,a=s.row,c=s.column,u=s.cell;if(this.hasCellRules(l,a,c))return this.validCellRules(l,a,c).then(function(){"row"===e.mode&&n.visible&&n.row===a&&n.column===c&&i.clearValidate()}).catch(function(e){var t=e.rule;if(t.trigger&&l!==t.trigger)return Promise.resolve();var o={rule:t,row:a,column:c,cell:u};return i.showValidTooltip(o),Promise.reject(o)})}return Promise.resolve()},fullValidate:function(e,t){return this.beginValidate(e,t,!0)},validate:function(e,t){return this.beginValidate(e,t)},beginValidate:function(e,n,s){var a=this,c={},r=!0,t=this.editRules,o=this.tableData,l=this.tableFullData,u=this.scrollYLoad,i=u?l:o;e&&(_xeUtils.default.isFunction(e)?n=e:i=_xeUtils.default.isArray(e)?e:[e]);var h=[];if(this.lastCallTime=Date.now(),this.clearValidate(),t){var d=this.getColumns();return i.forEach(function(r){var e=[];d.forEach(function(i,n){_xeUtils.default.has(t,i.property)&&e.push(new Promise(function(o,l){a.validCellRules("all",r,i).then(o).catch(function(e){var t={rule:e.rule,rules:e.rules,rowIndex:a.getRowIndex(r),row:r,columnIndex:n,column:i,$table:a};return s?(c[i.property]||(c[i.property]=[]),c[i.property].push(t),o()):l(t)})}))}),h.push(Promise.all(e))}),Promise.all(h).then(function(){var e=Object.keys(c);if(e.length)return Promise.reject(c[e[0]][0]);n&&n(r)}).catch(function(l){var i=s?c:_defineProperty({},l.column.property,l);return new Promise(function(e,t){var o=function(){l.cell=_tools.DomTools.getCell(a,l),a.handleValidError(l),n?e(n(r=!1,i)):t(i)};u?a.scrollToRow(l.row,!0).then(o):o()})})}return n&&n(r),Promise.resolve(!0)},hasCellRules:function(t,e,o){var l=this.editRules,i=o.property;if(i&&l){var n=_xeUtils.default.get(l,i);return n&&n.find(function(e){return"all"===t||!e.trigger||t===e.trigger})}return!1},validCellRules:function(s,a,c,e){var u=this,t=this.editRules,o=c.property,h=[],l=[];if(o&&t){var d=_xeUtils.default.get(t,o),f=_xeUtils.default.isUndefined(e)?_xeUtils.default.get(a,o):e;d&&d.forEach(function(r){l.push(new Promise(function(o){var e=!0===r.required;if("all"!==s&&r.trigger&&s!==r.trigger)o();else if(_xeUtils.default.isFunction(r.validator))r.validator(r,f,function(e){if(_xeUtils.default.isError(e)){var t={type:"custom",trigger:r.trigger,message:e.message,rule:new Rule(r)};h.push(new Rule(t))}return o()},{rules:d,row:a,column:c,rowIndex:u.getRowIndex(a),columnIndex:u.getColumnIndex(c)});else{var t,l=f,i="number"===r.type,n=null==f||""===f;i?l=_xeUtils.default.toNumber(f):t=_xeUtils.default.getSize(l),e&&n?h.push(new Rule(r)):(i&&isNaN(f)||_xeUtils.default.isRegExp(r.pattern)&&!r.pattern.test(f)||_xeUtils.default.isNumber(r.min)&&(i?l<r.min:t<r.min)||_xeUtils.default.isNumber(r.max)&&(i?l>r.max:t>r.max))&&h.push(new Rule(r)),o()}}))})}return Promise.all(l).then(function(){if(h.length){var e={rules:h,rule:h[0]};return Promise.reject(e)}})},clearValidate:function(){var e=this.$refs.validTip;return Object.assign(this.validStore,{visible:!1,row:null,column:null,content:"",rule:null}),e&&e.visible&&e.close(),this.$nextTick()},handleValidError:function(e){var t=this;this.handleActived(e,{type:"valid-error",trigger:"call"}).then(function(){return t.showValidTooltip(e)})},showValidTooltip:function(e){var t=this,o=this.$refs,l=this.height,i=this.tableData,n=this.validOpts,r=e.rule,s=e.row,a=e.column,c=e.cell,u=o.validTip,h=r.message;this.$nextTick(function(){Object.assign(t.validStore,{row:s,column:a,rule:r,content:h,visible:!0}),u&&("tooltip"===n.message||"default"===n.message&&!l&&i.length<2)&&u.toVisible(c,h),_tools.UtilTools.emitEvent(t,"valid-error",[e])})},exportCsv:function(e){var t=this.visibleColumn,o=this.scrollXLoad,l=this.scrollYLoad,i=this.treeConfig,n=Object.assign({filename:"table.csv",original:!!i,isHeader:!0,isFooter:!0,download:!0,data:null,columns:null,columnFilterMethod:function(e){return-1===["index","selection","radio"].indexOf(e.type)&&e.property},dataFilterMethod:null},e);-1===n.filename.indexOf(".csv")&&(n.filename+=".csv"),n.original||(o||l)&&(n.original=!0,_tools.UtilTools.warn("s.error.scrollOriginal"));var r=t,s=this.tableFullData;return i&&(s=_xeUtils.default.toTreeArray(s,i)),_tools.ExportTools.downloadCsc(n,_tools.ExportTools.getCsvContent(this,n,r,s))},connect:function(e){var t=e.toolbar;this._toolbar=t},getEventTargetNode:_tools.DomTools.getEventTargetNode}};exports.default=_default2;